<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Deep Debug</title>
    <script src="config-manager.js"></script>
    <script src="github-service.js"></script>
</head>
<body>
    <h1>深度调试</h1>
    <div id="output"></div>

    <script>
        function log(msg) {
            const output = document.getElementById('output');
            output.innerHTML += '<p>' + msg + '</p>';
            console.log(msg);
        }

        log('=== 步骤1: 检查configManager ===');
        log('window.configManager 存在: ' + !!window.configManager);

        if (window.configManager) {
            log('typeof configManager: ' + typeof window.configManager);
            log('configManager.hasGitHubConfig: ' + typeof window.configManager.hasGitHubConfig);

            // 设置测试配置
            log('\n=== 步骤2: 设置测试配置 ===');
            window.configManager.setGitHubConfig({
                token: 'ghp_test123',
                owner: 'testowner',
                repo: 'testrepo'
            });
            log('✓ 配置已设置');

            // 读取配置
            log('\n=== 步骤3: 读取配置 ===');
            const config = window.configManager.getGitHubConfig();
            log('配置对象: ' + JSON.stringify(config, null, 2));

            // 检查hasGitHubConfig
            log('\n=== 步骤4: 检查hasGitHubConfig ===');
            const hasConfig = window.configManager.hasGitHubConfig();
            log('hasGitHubConfig(): ' + hasConfig);
            log('预期: true，实际: ' + hasConfig);

            if (!hasConfig) {
                log('❌ ERROR: hasGitHubConfig返回false，但配置已设置！');
                log('检查配置内容:');
                log('  token: ' + config.token);
                log('  owner: ' + config.owner);
                log('  repo: ' + config.repo);
            }
        }

        log('\n=== 步骤5: 检查githubService ===');
        log('window.githubService 存在: ' + !!window.githubService);
        log('window.GitHubService 存在: ' + !!window.GitHubService);

        if (window.githubService) {
            log('githubService.loadConfig 存在: ' + !!window.githubService.loadConfig);
            log('githubService.isConfigured 存在: ' + !!window.githubService.isConfigured);

            // 尝试加载配置
            log('\n=== 步骤6: 让githubService加载配置 ===');
            const loaded = window.githubService.loadConfig();
            log('loadConfig返回: ' + JSON.stringify(loaded));
            log('isConfigured(): ' + window.githubService.isConfigured());
            log('token: ' + window.githubService.token);
            log('owner: ' + window.githubService.owner);
            log('repo: ' + window.githubService.repo);
        }

        log('\n=== 步骤7: localStorage检查 ===');
        log('localStorage中的github-config:');
        const stored = localStorage.getItem('github-config');
        log(stored || '(不存在)');
    </script>
</body>
</html>
