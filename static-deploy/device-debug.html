#!/usr/bin/env python3
"""
检测当前设备的精确参数
用于调试iOS PWA启动画面问题
"""

import json

# 创建一个调试页面来检测设备参数
debug_html = '''<!DOCTYPE html>
<html style="background: #000000 !important;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>设备检测调试页面</title>
    <style>
        body {
            background: #000000 !important;
            color: #00ff00;
            font-family: monospace;
            margin: 20px;
            line-height: 1.6;
        }
        .info {
            border: 1px solid #333;
            padding: 10px;
            margin: 10px 0;
            background: #111;
        }
        .highlight {
            color: #ffff00;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>设备参数检测</h1>
    <div class="info">
        <h3>屏幕信息</h3>
        <div>Screen Width: <span class="highlight" id="screenWidth"></span></div>
        <div>Screen Height: <span class="highlight" id="screenHeight"></span></div>
        <div>Device Pixel Ratio: <span class="highlight" id="dpr"></span></div>
        <div>Viewport Width: <span class="highlight" id="viewportWidth"></span></div>
        <div>Viewport Height: <span class="highlight" id="viewportHeight"></span></div>
    </div>

    <div class="info">
        <h3>设备特征</h3>
        <div>User Agent: <span class="highlight" id="userAgent"></span></div>
        <div>Platform: <span class="highlight" id="platform"></span></div>
        <div>Touch Support: <span class="highlight" id="touchSupport"></span></div>
        <div>Standalone Mode: <span class="highlight" id="standalone"></span></div>
    </div>

    <div class="info">
        <h3>CSS Media Query 匹配</h3>
        <div id="mediaQueries"></div>
    </div>

    <div class="info">
        <h3>建议的启动画面配置</h3>
        <div id="splashConfig"></div>
    </div>

    <script>
        function updateInfo() {
            // 基本屏幕信息
            document.getElementById('screenWidth').textContent = screen.width;
            document.getElementById('screenHeight').textContent = screen.height;
            document.getElementById('dpr').textContent = window.devicePixelRatio;
            document.getElementById('viewportWidth').textContent = window.innerWidth;
            document.getElementById('viewportHeight').textContent = window.innerHeight;

            // 设备信息
            document.getElementById('userAgent').textContent = navigator.userAgent;
            document.getElementById('platform').textContent = navigator.platform;
            document.getElementById('touchSupport').textContent = 'ontouchstart' in window ? 'Yes' : 'No';
            document.getElementById('standalone').textContent = window.navigator.standalone ? 'Yes' : 'No';

            // 测试各种媒体查询
            const queries = [
                '(device-width: 402px) and (device-height: 874px) and (-webkit-device-pixel-ratio: 3)',
                '(device-width: 874px) and (device-height: 402px) and (-webkit-device-pixel-ratio: 3)',
                '(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3)',
                '(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3)',
                '(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3)',
                '(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)'
            ];

            let mediaQueriesHtml = '';
            queries.forEach(query => {
                const matches = window.matchMedia(query).matches;
                mediaQueriesHtml += `<div style="color: ${matches ? '#00ff00' : '#ff0000'}">${query}: ${matches ? 'MATCH' : 'NO MATCH'}</div>`;
            });
            document.getElementById('mediaQueries').innerHTML = mediaQueriesHtml;

            // 生成启动画面配置建议
            const deviceWidth = Math.min(window.innerWidth, window.innerHeight);
            const deviceHeight = Math.max(window.innerWidth, window.innerHeight);
            const dpr = window.devicePixelRatio;
            const physicalWidth = deviceWidth * dpr;
            const physicalHeight = deviceHeight * dpr;

            const configHtml = `
                <div>Device Width: ${deviceWidth}px</div>
                <div>Device Height: ${deviceHeight}px</div>
                <div>Physical Resolution: ${physicalWidth} x ${physicalHeight}</div>
                <div style="color: #ffff00; margin-top: 10px;">建议的media query:</div>
                <div style="color: #00ffff; font-size: 12px; word-break: break-all;">
                media="(device-width: ${deviceWidth}px) and (device-height: ${deviceHeight}px) and (-webkit-device-pixel-ratio: ${dpr})"
                </div>
                <div style="color: #ffff00; margin-top: 10px;">建议的启动画面尺寸:</div>
                <div style="color: #00ffff;">竖屏: ${physicalWidth} x ${physicalHeight}</div>
                <div style="color: #00ffff;">横屏: ${physicalHeight} x ${physicalWidth}</div>
            `;
            document.getElementById('splashConfig').innerHTML = configHtml;
        }

        // 页面加载和窗口大小变化时更新信息
        window.addEventListener('load', updateInfo);
        window.addEventListener('resize', updateInfo);
        window.addEventListener('orientationchange', function() {
            setTimeout(updateInfo, 500); // 延迟更新，等待方向变化完成
        });

        // 立即更新一次
        updateInfo();
    </script>
</body>
</html>'''

with open('device-debug.html', 'w', encoding='utf-8') as f:
    f.write(debug_html)

print("调试页面已创建: device-debug.html")
print("请在iPhone 17 Pro上访问这个页面来获取准确的设备参数")