<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlogWriter - GitHub Auto Deploy</title>
    <meta name="version" content="1.2">

    <!-- ç§»åŠ¨è®¾å¤‡çŠ¶æ€æ æ ·å¼ -->
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="msapplication-navbutton-color" content="#000000">

    <link rel="icon" type="image/png" href="./img/icons/write.png">
    <script src="https://unpkg.com/vue@2.6.14/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui@2.15.13/lib/index.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui@2.15.13/lib/theme-chalk/index.css">
    <script src="https://cdn.jsdelivr.net/npm/vditor@3.9.4/dist/index.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vditor@3.9.4/dist/index.css">
    <script src="github-service.js"></script>
    <script src="image-service.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            transition: all 0.3s ease;
        }

        /* æš—å¤œæ¨¡å¼æ ·å¼ */
        .dark-mode {
            background: #000000 !important;
            color: #e0e0e0;
        }

        .dark-mode .header {
            background: #000000 !important;
            border-bottom-color: #888;
        }

        .dark-mode .content-type-selector {
            background: #000000;
        }

        /* å…‹è±å› è“æŒ‰é’®æ ·å¼ */
        .dark-mode .content-type-selector .el-button--primary,
        .dark-mode .el-button--primary {
            background: #002FA7 !important;
            border-color: #002FA7 !important;
            color: white !important;
        }

        .dark-mode .content-type-selector .el-button--primary:hover,
        .dark-mode .el-button--primary:hover {
            background: #0033B8 !important;
            border-color: #0033B8 !important;
            color: white !important;
        }

        /* å¼ºåˆ¶è¦†ç›–Element UIçš„é»˜è®¤æ ·å¼ */
        .dark-mode .content-type-selector .el-button.el-button--primary {
            background-color: #002FA7 !important;
            border-color: #002FA7 !important;
        }

        .dark-mode .content-type-selector .el-button.el-button--primary:hover {
            background-color: #0033B8 !important;
            border-color: #0033B8 !important;
        }

        /* å‘å¸ƒæŒ‰é’®å›¾æ ‡å¤§å° */
        .publish-button .el-icon-upload {
            font-size: 18px !important;
        }

        /* å‘å¸ƒæŒ‰é’®æˆåŠŸåŠ¨ç”» */
        .publish-button.success {
            background-color: #4CAF50 !important;
            border-color: #4CAF50 !important;
            animation: successPulse 0.6s ease-out;
        }

        @keyframes successPulse {
            0% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 4px 16px rgba(76, 175, 80, 0.6);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
            }
        }

        /* GitHubé…ç½®æŒ‰é’® */
        .github-config-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            background: #24292e;
            color: white;
            margin-left: 10px;
        }

        .github-config-button:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
            background: #333;
        }

        .github-config-button .el-icon-setting {
            font-size: 18px;
        }

        /* è‡ªå®šä¹‰å›¾æ ‡æ ·å¼ */
        .github-config-button img {
            transition: all 0.3s ease;
            /* å°†é»‘è‰²çº¿æ¡è½¬æ¢ä¸ºç™½è‰² */
            filter: invert(1) brightness(0.9);
        }

        .github-config-button:hover img {
            filter: invert(1) brightness(1.1) drop-shadow(0 0 3px rgba(255,255,255,0.3));
            transform: scale(1.05);
        }

        /* Vditor YAML frontmatter é¢„è§ˆæ ·å¼ */
        .vditor-preview .language-yaml,
        .vditor-preview pre[data-lang="yaml"],
        .vditor-preview code.language-yaml {
            background: #002FA7 !important;
            color: white !important;
            border: 1px solid #0033B8 !important;
        }

        /* Vditor ç¼–è¾‘å™¨ä¸­çš„ YAML ä»£ç å—æ ·å¼ */
        .vditor-ir pre.vditor-ir__marker--pre code,
        .vditor-wysiwyg pre code {
            background: #002FA7 !important;
            color: white !important;
        }

        /* é’ˆå¯¹ frontmatter çš„ç‰¹æ®Šæ ·å¼ */
        .vditor-preview hr + pre,
        .vditor-preview hr + pre code {
            background: #002FA7 !important;
            color: white !important;
            border: 2px solid #0033B8 !important;
            border-radius: 6px !important;
        }

        /* æ›´å¼ºåˆ¶çš„æ ·å¼è¦†ç›– - é’ˆå¯¹æ‰€æœ‰å¯èƒ½çš„YAMLæ˜¾ç¤º */
        .vditor-preview pre,
        .vditor-preview pre code,
        .vditor-preview .hljs,
        .vditor-preview .hljs-attr,
        .vditor-preview .hljs-string,
        .vditor-preview .hljs-literal {
            background: #002FA7 !important;
            color: white !important;
        }

        /* ç¡®ä¿YAMLè¯­æ³•é«˜äº®ä¹Ÿä½¿ç”¨å…‹è±å› è“ */
        .vditor-preview .hljs-attr {
            color: #FFD700 !important; /* é‡‘è‰²ç”¨äºå±æ€§å */
        }

        .vditor-preview .hljs-string {
            color: #90EE90 !important; /* æµ…ç»¿è‰²ç”¨äºå­—ç¬¦ä¸²å€¼ */
        }

        .vditor-preview .hljs-literal {
            color: #FFA500 !important; /* æ©™è‰²ç”¨äºå­—é¢é‡ */
        }

        .dark-mode .editor-container {
            background: #000000 !important;
        }

        .dark-mode #vditor {
            background: #000000 !important;
        }

        .dark-mode .vditor {
            background: #000000 !important;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-bottom: none;
            padding: 15px 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            color: white;
        }
        .content-type-selector {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }
        .type-buttons {
            display: flex;
            gap: 12px;
        }
        .action-buttons {
            display: flex;
            gap: 12px;
        }

        /* ç¾åŒ–æŒ‰é’®æ ·å¼ - åœ†å½¢æŒ‰é’® */
        .el-button {
            border-radius: 25px !important;
            font-weight: 500 !important;
            transition: all 0.3s ease !important;
            padding: 12px 24px !important;
        }

        .el-button:hover {
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
        }

        .el-button.is-circle {
            border-radius: 50% !important;
            width: 40px !important;
            height: 40px !important;
            padding: 0 !important;
        }
        .editor-container {
            height: calc(100vh - 90px);
            padding: 0;
            background: #fafafa;
        }
        .metadata-editor {
            display: flex;
            gap: 15px;
            padding: 10px 15px;
            background-color: #000000;
            border-bottom: 1px solid #30363d;
            position: sticky;
            top: 41px; /* Vditor toolbar height */
            z-index: 2;
        }
        .metadata-editor .el-input {
            flex: 1;
        }
        .metadata-editor .el-input[placeholder="æ–‡ç« æ ‡é¢˜"] {
            flex: 2; /* æ ‡é¢˜æ¡†æ›´å®½ */
        }
        .metadata-editor .el-input__inner {
            height: 32px;
            line-height: 32px;
        }
        .dark-mode .el-input__inner {
            background-color: #1a1a1a !important;
            border-color: #555 !important;
            color: #e0e0e0 !important;
        }
        .dark-mode .el-input__inner:hover, .dark-mode .el-input__inner:focus {
            border-color: #002FA7 !important;
        }
        #vditor {
            height: 100%;
            border-radius: 0;
        }

        /* ç¼–è¾‘å™¨å­—ä½“å¤§å° */
        .vditor-sv .vditor-sv__main textarea,
        .vditor-wysiwyg .vditor-wysiwyg__main {
            font-size: 16px !important;
            line-height: 1.6 !important;
        }

        /* æš—å¤œæ¨¡å¼ä¸‹çš„ç¼–è¾‘å™¨æ ·å¼ */
        .dark-mode .editor-container {
            background: #000000 !important;
        }

        .dark-mode .header {
            background: #000000 !important;
        }

        .dark-mode .vditor-toolbar {
            background: #000000 !important;
            border-bottom-color: #888 !important;
        }

        .dark-mode .vditor-content {
            background: #000000 !important;
        }

        /* ç¡®ä¿æ‰€è§å³æ‰€å¾—æ¨¡å¼å’Œå³æ—¶æ¸²æŸ“æ¨¡å¼ä¸‹ç¼–è¾‘å™¨èƒŒæ™¯ä¸ºçº¯é»‘è‰² */
        .dark-mode .vditor-wysiwyg {
            background: #000000 !important;
        }

        .dark-mode .vditor-wysiwyg .vditor-wysiwyg__main {
            background: #000000 !important;
            color: #e0e0e0 !important;
        }

        /* æ›´å¼ºåˆ¶çš„æ‰€è§å³æ‰€å¾—æ¨¡å¼èƒŒæ™¯è®¾ç½® */
        .dark-mode .vditor-wysiwyg__main,
        .dark-mode .vditor-wysiwyg__main .vditor-wysiwyg__main,
        .dark-mode .vditor-wysiwyg .vditor-wysiwyg__main .vditor-wysiwyg__main,
        .dark-mode .vditor-wysiwyg__main > div,
        .dark-mode .vditor-wysiwyg__main .vditor-wysiwyg__main > div {
            background: #000000 !important;
            background-color: #000000 !important;
            color: #e0e0e0 !important;
        }

        /* é’ˆå¯¹æ‰€è§å³æ‰€å¾—æ¨¡å¼çš„ç¼–è¾‘åŒºåŸŸ */
        .dark-mode .vditor-wysiwyg__main[contenteditable="true"] {
            background: #000000 !important;
            background-color: #000000 !important;
            color: #e0e0e0 !important;
        }

        .dark-mode .vditor-ir {
            background: #000000 !important;
        }

        .dark-mode .vditor-ir .vditor-ir__main {
            background: #000000 !important;
            color: #e0e0e0 !important;
        }

        .dark-mode .vditor-ir .vditor-ir__main textarea {
            background: #000000 !important;
            color: #e0e0e0 !important;
        }

        /* ç¡®ä¿é¢„è§ˆåŒºåŸŸä¹Ÿæ˜¯çº¯é»‘è‰²èƒŒæ™¯ */
        .dark-mode .vditor-preview {
            background: #000000 !important;
            color: #e0e0e0 !important;
        }

        /* å¼ºåˆ¶è¦†ç›–æ‰€æœ‰å¯èƒ½çš„VditorèƒŒæ™¯æ ·å¼ */
        .dark-mode .vditor-wysiwyg *,
        .dark-mode .vditor-ir * {
            background-color: transparent !important;
        }

        .dark-mode .vditor-wysiwyg,
        .dark-mode .vditor-wysiwyg__main,
        .dark-mode .vditor-ir,
        .dark-mode .vditor-ir__main {
            background: #000000 !important;
            background-color: #000000 !important;
        }

        .dark-mode .vditor-sv {
            background: #000000 !important;
        }

        .dark-mode .vditor-sv .vditor-sv__main {
            background: #000000 !important;
        }

        .dark-mode .vditor-sv .vditor-sv__preview {
            background: #000000 !important;
        }

        .dark-mode .vditor-sv .vditor-sv__preview .vditor-reset {
            background: #000000 !important;
            color: #e0e0e0 !important;
        }

        .dark-mode .vditor-preview {
            background: #000000 !important;
        }

        .dark-mode .vditor-preview .vditor-reset {
            background: #000000 !important;
            color: #e0e0e0 !important;
        }

        /* éšè—é¢„è§ˆå·¥å…·æ çš„Desktop/Tablet/Mobileç­‰é€‰é¡¹ */
        .vditor-preview__action,
        .vditor-preview__action--current,
        .vditor-preview__action[data-type="desktop"],
        .vditor-preview__action[data-type="tablet"],
        .vditor-preview__action[data-type="mobile"],
        .vditor-preview__action[data-type="mp-wechat"],
        .vditor-preview__action[data-type="zhihu"] {
            display: none !important;
        }

        /* éšè—æ•´ä¸ªé¢„è§ˆå·¥å…·æ  */
        .vditor-preview__toolbar {
            display: none !important;
        }

        /* ç¾åŒ–GitHubé…ç½®å¼¹çª— */
        .el-dialog, .el-dialog__wrapper {
            background: transparent !important;
        }

        .github-config-dialog .el-dialog {
            background: #161b22 !important;
            border-radius: 25px !important;
            border: 1px solid #30363d !important;
            box-shadow: 0 8px 24px rgba(0,0,0,0.5) !important;
        }

        .github-config-dialog .el-dialog__header {
            background: #161b22 !important;
            color: #c9d1d9 !important;
            border-bottom: 1px solid #30363d !important;
        }

        .github-config-dialog .el-dialog__title {
            font-size: 18px !important;
            font-weight: 600;
            color: #e0e0e0 !important;
        }

        .github-config-dialog .el-dialog__body {
            background: #0d1117 !important;
            color: #c9d1d9 !important;
            padding: 25px 30px !important;
        }

        .github-config-dialog .el-form-item__label {
            color: #c9d1d9 !important;
            white-space: nowrap;
        }

        .github-config-dialog .el-input__inner {
            background: #010409 !important;
            border: 1px solid #30363d !important;
            color: #c9d1d9 !important;
            border-radius: 20px !important;
        }

        .github-config-dialog .el-input__inner:focus {
            border-color: #002FA7 !important;
            box-shadow: 0 0 0 3px rgba(0, 47, 167, 0.3) !important;
        }

        .github-config-dialog .token-instructions {
            font-size: 12px;
            color: #8b949e;
            margin-top: 8px;
            line-height: 1.6;
            background: #161b22;
            padding: 10px;
            border-radius: 6px;
        }

        .github-config-dialog .el-dialog__footer {
            background: #161b22 !important;
            border-top: 1px solid #30363d !important;
            padding: 15px 30px !important;
        }

        .github-config-dialog .test-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            font-weight: 500;
        }

        .github-config-dialog .test-result.success {
            background-color: rgba(34, 139, 34, 0.2);
            color: #3fb950;
            border: 1px solid rgba(34, 139, 34, 0.5);
        }

        .github-config-dialog .test-result.error {
            background-color: rgba(210, 4, 45, 0.2);
            color: #f85149;
            border: 1px solid rgba(210, 4, 45, 0.5);
        }

        .metadata-info {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            margin-left: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 8px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .dark-mode .metadata-info {
            color: rgba(224, 224, 224, 0.8);
            background: rgba(255, 255, 255, 0.1);
        }

        /* ä¿å­˜æŒ‰é’®å…‹è±å› è“æ ·å¼ - æ›´å¼ºåˆ¶çš„é€‰æ‹©å™¨ */
        .save-button,
        .el-dialog .save-button,
        .el-dialog__footer .save-button,
        .el-dialog .el-button.save-button,
        .el-dialog__footer .el-button.save-button,
        button.save-button,
        .el-button--primary.save-button {
            background: #002FA7 !important;
            background-color: #002FA7 !important;
            border-color: #002FA7 !important;
            color: white !important;
            box-shadow: none !important;
        }

        .save-button:hover,
        .el-dialog .save-button:hover,
        .el-dialog__footer .save-button:hover,
        .el-dialog .el-button.save-button:hover,
        .el-dialog__footer .el-button.save-button:hover,
        button.save-button:hover,
        .el-button--primary.save-button:hover {
            background: #0033B8 !important;
            background-color: #0033B8 !important;
            border-color: #0033B8 !important;
            color: white !important;
            box-shadow: none !important;
        }

        .save-button:focus,
        .save-button:active,
        .el-dialog .save-button:focus,
        .el-dialog .save-button:active,
        .el-dialog__footer .save-button:focus,
        .el-dialog__footer .save-button:active,
        .el-dialog .el-button.save-button:focus,
        .el-dialog .el-button.save-button:active,
        .el-dialog__footer .el-button.save-button:focus,
        .el-dialog__footer .el-button.save-button:active,
        button.save-button:focus,
        button.save-button:active,
        .el-button--primary.save-button:focus,
        .el-button--primary.save-button:active {
            background: #002FA7 !important;
            background-color: #002FA7 !important;
            border-color: #002FA7 !important;
            color: white !important;
            box-shadow: none !important;
        }

        .dark-mode .el-button {
            background: #333 !important;
            border-color: #555 !important;
            color: #e0e0e0 !important;
        }

        .dark-mode .el-button:hover {
            background: #444 !important;
            border-color: #666 !important;
        }

        .dark-mode .el-button--primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            border-color: transparent !important;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header {
                padding: 12px 15px;
            }

            .content-type-selector {
                /* ä¿æŒæ°´å¹³å¸ƒå±€ï¼Œè®©æ‰€æœ‰æŒ‰é’®åœ¨ä¸€è¡Œ */
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
                gap: 8px;
            }

            .type-buttons {
                display: flex;
                gap: 8px;
                flex-shrink: 0;
            }

            .action-buttons {
                display: flex;
                gap: 8px;
                flex-shrink: 0;
            }

            /* å‡å°ç§»åŠ¨ç«¯æŒ‰é’®å°ºå¯¸ä»¥é€‚åº”ä¸€è¡Œæ˜¾ç¤º */
            .type-buttons .el-button {
                padding: 8px 12px !important;
                font-size: 13px !important;
            }

            .github-config-button {
                width: 36px !important;
                height: 36px !important;
            }

            .publish-button {
                padding: 8px 12px !important;
            }
        }

        @media (max-width: 480px) {
            .editor-container {
                height: calc(100vh - 120px);
            }

            /* è¶…å°å±å¹•è¿›ä¸€æ­¥ä¼˜åŒ–æŒ‰é’®å°ºå¯¸ */
            .type-buttons .el-button {
                padding: 6px 10px !important;
                font-size: 12px !important;
            }

            .github-config-button {
                width: 32px !important;
                height: 32px !important;
            }

            .publish-button {
                padding: 6px 10px !important;
            }

            .content-type-selector {
                gap: 6px;
            }

            .type-buttons,
            .action-buttons {
                gap: 6px;
            }
        }

        /* ç§»åŠ¨ç«¯å¼¹çª—ä¼˜åŒ– */
        @media (max-width: 768px) {
            .el-dialog {
                width: 90% !important;
                max-width: 400px !important;
                margin: 0 auto !important;
                top: 15vh !important;
                transform: none !important;
            }

            .el-dialog__header {
                padding: 15px 20px 10px !important;
            }

            .el-dialog__body {
                padding: 10px 20px 20px !important;
                max-height: 60vh !important;
                overflow-y: auto !important;
            }

            .el-dialog__footer {
                padding: 10px 20px 15px !important;
            }
        }

        @media (max-width: 480px) {
            .el-dialog {
                width: 95% !important;
                max-width: 350px !important;
                top: 10vh !important;
            }

            .el-dialog__header {
                padding: 12px 15px 8px !important;
            }

            .el-dialog__body {
                padding: 8px 15px 15px !important;
                max-height: 65vh !important;
                font-size: 14px !important;
            }

            .el-dialog__footer {
                padding: 8px 15px 12px !important;
            }

            /* ç§»åŠ¨ç«¯è¡¨å•å…ƒç´ ä¼˜åŒ– */
            .el-input__inner {
                font-size: 16px !important; /* é˜²æ­¢iOSç¼©æ”¾ */
            }

            .el-button {
                padding: 8px 15px !important;
                font-size: 14px !important;
            }
        }

        /* å›¾ç‰‡æ‹–æ‹½æ ·å¼ */
        .drag-over {
            border: 2px dashed #002FA7 !important;
            background-color: rgba(0, 47, 167, 0.1) !important;
            position: relative;
        }

        .drag-over::after {
            content: 'æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ä¸Šä¼ ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 47, 167, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            z-index: 1000;
            pointer-events: none;
        }

        /* å›¾ç‰‡ä¸Šä¼ è¿›åº¦æ ·å¼ */
        .upload-progress {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 5px;
            z-index: 2000;
            min-width: 300px;
        }

        .upload-progress .progress-item {
            margin-bottom: 10px;
        }

        .upload-progress .progress-item:last-child {
            margin-bottom: 0;
        }

        /* PWAé…ç½®å¯¹è¯æ¡†æ ·å¼ */
        .pwa-config-dialog .el-message-box {
            width: 90% !important;
            max-width: 400px !important;
        }

        .pwa-config-dialog .el-message-box__message {
            font-size: 14px !important;
            line-height: 1.6 !important;
            color: #606266 !important;
        }

        .pwa-config-dialog .el-message-box__btns {
            padding: 15px 20px 20px !important;
        }

        .pwa-config-dialog .el-button {
            font-size: 14px !important;
            padding: 8px 16px !important;
        }

        /* å¿«é€Ÿé…ç½®æŒ‰é’®æ ·å¼ */
        .quick-config-button {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4) !important;
            border: none !important;
            animation: quickConfigPulse 2s infinite;
        }

        .quick-config-button:hover {
            background: linear-gradient(45deg, #FF5252, #26C6DA) !important;
            transform: scale(1.05);
        }

        @keyframes quickConfigPulse {
            0%, 100% {
                box-shadow: 0 0 5px rgba(255, 107, 107, 0.5);
            }
            50% {
                box-shadow: 0 0 15px rgba(78, 205, 196, 0.7);
            }
        }

        /* ä¸»é¢˜è°ƒè‰²ç›˜æ ·å¼ */
        .theme-palette-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4, #45B7D1, #96CEB4, #FFEAA7);
            background-size: 300% 300%;
            animation: gradientShift 3s ease infinite;
            margin-left: 10px;
            position: relative;
            overflow: hidden;
        }

        .theme-palette-button::before {
            content: 'ğŸ¨';
            font-size: 18px;
            z-index: 2;
            position: relative;
        }

        .theme-palette-button:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 16px rgba(0,0,0,0.4);
            animation-duration: 1s;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ä¸»é¢˜é€‰æ‹©å™¨å¼¹çª—æ ·å¼ */
        .theme-selector-dialog .el-dialog {
            background: #161b22 !important;
            border-radius: 25px !important;
            border: 1px solid #30363d !important;
            box-shadow: 0 8px 24px rgba(0,0,0,0.5) !important;
        }

        .theme-selector-dialog .el-dialog__header {
            background: #161b22 !important;
            color: #c9d1d9 !important;
            border-bottom: 1px solid #30363d !important;
            text-align: center;
        }

        .theme-selector-dialog .el-dialog__title {
            font-size: 20px !important;
            font-weight: 600;
            color: #e0e0e0 !important;
        }

        .theme-selector-dialog .el-dialog__body {
            background: #0d1117 !important;
            color: #c9d1d9 !important;
            padding: 30px !important;
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .theme-option {
            position: relative;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            text-align: center;
            color: white;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        .theme-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: inherit;
            opacity: 0.9;
            z-index: 1;
        }

        .theme-option .theme-content {
            position: relative;
            z-index: 2;
        }

        .theme-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            border-color: rgba(255,255,255,0.3);
        }

        .theme-option.active {
            border-color: #4ECDC4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.5);
            transform: scale(1.05);
        }

        .theme-option .theme-name {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .theme-option .theme-preview {
            font-size: 24px;
            margin-bottom: 5px;
        }

        /* é¢„è®¾ä¸»é¢˜æ ·å¼ */
        .theme-dark { background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%); }
        .theme-ocean { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .theme-sunset { background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%); }
        .theme-forest { background: linear-gradient(135deg, #134e5e 0%, #71b280 100%); }
        .theme-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .theme-pink { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .theme-blue { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .theme-green { background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%); }
        .theme-orange { background: linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%); }
        .theme-red { background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); }
        .theme-teal { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .theme-indigo { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }

        /* è‡ªå®šä¹‰é¢œè‰²é€‰æ‹©å™¨æ ·å¼ */
        .custom-color-section {
            border-top: 1px solid #30363d;
            padding-top: 20px;
            margin-top: 20px;
        }

        .color-picker-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .color-picker {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .color-picker:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        .gradient-preview {
            flex: 1;
            height: 50px;
            border-radius: 25px;
            border: 2px solid #30363d;
            transition: all 0.3s ease;
        }

        .gradient-preview:hover {
            border-color: #4ECDC4;
        }

        /* ä¸»é¢˜æ¨¡å¼æ ·å¼ */
        .themed-mode {
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .themed-mode .header {
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .themed-mode .el-button {
            background: rgba(255,255,255,0.2) !important;
            border-color: rgba(255,255,255,0.3) !important;
            color: white !important;
            backdrop-filter: blur(10px);
        }

        .themed-mode .el-button:hover {
            background: rgba(255,255,255,0.3) !important;
            border-color: rgba(255,255,255,0.5) !important;
            transform: translateY(-1px);
        }

        .themed-mode .el-button--primary {
            background: rgba(255,255,255,0.3) !important;
            border-color: rgba(255,255,255,0.4) !important;
        }

        .themed-mode .el-button--primary:hover {
            background: rgba(255,255,255,0.4) !important;
            border-color: rgba(255,255,255,0.6) !important;
        }

        .themed-mode .github-config-button {
            background: rgba(255,255,255,0.2) !important;
            backdrop-filter: blur(10px);
        }

        .themed-mode .github-config-button:hover {
            background: rgba(255,255,255,0.3) !important;
        }

        .themed-mode .metadata-editor {
            background: rgba(0,0,0,0.3) !important;
            backdrop-filter: blur(10px);
        }

        .themed-mode .el-input__inner {
            background: rgba(255,255,255,0.1) !important;
            border-color: rgba(255,255,255,0.3) !important;
            color: white !important;
            backdrop-filter: blur(10px);
        }

        .themed-mode .el-input__inner:hover,
        .themed-mode .el-input__inner:focus {
            border-color: rgba(255,255,255,0.5) !important;
            background: rgba(255,255,255,0.15) !important;
        }

        .themed-mode .vditor-toolbar {
            background: rgba(0,0,0,0.3) !important;
            backdrop-filter: blur(10px);
            border-bottom-color: rgba(255,255,255,0.2) !important;
        }

        /* å“åº”å¼ä¸»é¢˜æŒ‰é’® */
        @media (max-width: 768px) {
            .theme-palette-button {
                width: 36px !important;
                height: 36px !important;
                margin-left: 5px;
            }

            .theme-palette-button::before {
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .theme-palette-button {
                width: 32px !important;
                height: 32px !important;
            }

            .theme-palette-button::before {
                font-size: 14px;
            }

            .theme-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .theme-option {
                padding: 15px;
            }
        }


    </style>
</head>
<body class="dark-mode">
    <div id="app">
        <div class="header">
            <div class="content-type-selector">
                <div class="type-buttons">
                    <el-button
                        v-for="(label, type) in contentTypeLabels"
                        :key="type"
                        :type="currentType === type ? 'primary' : 'default'"
                        @click="selectType(type)"
                        size="small">
                        <i :class="getTypeIcon(type)"></i>
                        {{ label }}
                    </el-button>
                    <button class="github-config-button" @click="configureGitHub" :title="isGitHubConfigured ? 'GitHubå·²é…ç½®' : 'é…ç½®GitHub'">
                        <i class="el-icon-setting"></i>
                    </button>
                    <button class="github-config-button" @click="configureImageService" :title="isImageServiceConfigured ? 'å›¾åºŠå·²é…ç½®' : 'é…ç½®å›¾åºŠ'" style="margin-left: 5px;">
                        <img src="./img/icons/pic.png" alt="å›¾åºŠé…ç½®" style="width: 16px; height: 16px;">
                    </button>
                    <button v-if="isPWAMode && !isImageServiceConfigured" class="github-config-button quick-config-button" @click="showQuickConfig" title="PWAå¿«é€Ÿé…ç½®" style="margin-left: 5px;">
                        <i class="el-icon-magic-stick"></i>
                    </button>
                    <button class="theme-palette-button" @click="showThemeSelector" title="ä¸»é¢˜è°ƒè‰²ç›˜"></button>
                </div>
                <div class="action-buttons">
                    <el-button @click="publish" size="medium" type="success" icon="el-icon-upload" :disabled="!isGitHubConfigured" class="publish-button">
                    </el-button>
                </div>
            </div>
        </div>

        <div class="editor-container">
            <!-- å…ƒæ•°æ®ç¼–è¾‘å™¨å°†é€šè¿‡JSç§»åŠ¨åˆ°Vditorå·¥å…·æ ä¸‹æ–¹ -->
            <div id="metadata-editor-wrapper" style="display: none;">
                <div class="metadata-editor"
                     v-if="currentType !== 'general' && currentType !== 'gallery' && currentType !== 'essay' && hasVisibleFields">
                    <el-input v-if="metadataFields[currentType].some(f => f.key === 'title')" v-model="metadata.title" placeholder="Title" size="small"></el-input>
                    <el-input v-if="metadataFields[currentType].some(f => f.key === 'categories')" v-model="metadata.categories" placeholder="Categories (comma-separated)" size="small"></el-input>
                    <el-input v-if="metadataFields[currentType].some(f => f.key === 'description')" v-model="metadata.description" placeholder="Description" size="small"></el-input>
                    <el-date-picker v-if="metadataFields[currentType].some(f => f.key === 'date' && f.type === 'date')" v-model="metadata.date" type="date" placeholder="æ‹æ‘„æ—¥æœŸ" size="small" format="yyyy-MM-dd" value-format="yyyy-MM-dd"></el-date-picker>
                </div>
            </div>

            <div id="vditor"></div>
        </div>



        <github-config
            :visible="githubConfigVisible"
            @close="githubConfigVisible = false"
            @save="handleGitHubConfigSave">
        </github-config>

        <image-service-config
            :visible="imageConfigVisible"
            @close="imageConfigVisible = false"
            @save="handleImageServiceConfigSave">
        </image-service-config>

        <!-- ä¸»é¢˜é€‰æ‹©å™¨å¼¹çª— -->
        <el-dialog
            title="ğŸ¨ ä¸»é¢˜è°ƒè‰²ç›˜"
            :visible.sync="themeDialogVisible"
            width="600px"
            custom-class="theme-selector-dialog">
            <div class="theme-grid">
                <div
                    v-for="theme in themeOptions"
                    :key="theme.name"
                    :class="['theme-option', theme.class, { active: currentTheme === theme.name }]"
                    @click="selectTheme(theme.name, theme.colors)">
                    <div class="theme-content">
                        <div class="theme-preview">{{ theme.icon }}</div>
                        <div class="theme-name">{{ theme.label }}</div>
                    </div>
                </div>
            </div>

            <div class="custom-color-section">
                <h4 style="color: #c9d1d9; margin-bottom: 15px;">ğŸ¯ è‡ªå®šä¹‰æ¸å˜</h4>
                <div class="color-picker-container">
                    <input type="color" v-model="customColors.start" class="color-picker" title="èµ·å§‹é¢œè‰²">
                    <input type="color" v-model="customColors.end" class="color-picker" title="ç»“æŸé¢œè‰²">
                    <div
                        class="gradient-preview"
                        :style="{ background: `linear-gradient(135deg, ${customColors.start} 0%, ${customColors.end} 100%)` }"
                        @click="applyCustomTheme"
                        title="ç‚¹å‡»åº”ç”¨è‡ªå®šä¹‰ä¸»é¢˜">
                    </div>
                </div>
                <p style="font-size: 12px; color: #8b949e; margin: 0;">é€‰æ‹©ä¸¤ç§é¢œè‰²ï¼Œç„¶åç‚¹å‡»é¢„è§ˆæ¡åº”ç”¨è‡ªå®šä¹‰æ¸å˜ä¸»é¢˜</p>
            </div>

            <div slot="footer" class="dialog-footer">
                <el-button @click="resetToDefault">æ¢å¤é»˜è®¤</el-button>
                <el-button type="primary" @click="themeDialogVisible = false">å®Œæˆ</el-button>
            </div>
        </el-dialog>

        <!-- ä¸Šä¼ è¿›åº¦æç¤º -->
        <el-dialog
            title="å›¾ç‰‡ä¸Šä¼ ä¸­"
            :visible.sync="uploadProgress.visible"
            width="400px"
            :close-on-click-modal="false"
            :close-on-press-escape="false"
            :show-close="false">
            <div style="text-align: center;">
                <p>æ­£åœ¨ä¸Šä¼ ç¬¬ {{ uploadProgress.current }} / {{ uploadProgress.total }} å¼ å›¾ç‰‡</p>
                <p>{{ uploadProgress.fileName }}</p>
                <p>{{ getStageText(uploadProgress.stage) }}</p>
                <div v-if="uploadProgress.stage === 'compressing' && uploadProgress.currentSize > 0" style="font-size: 12px; color: #666; margin: 5px 0;">
                    <p>å‹ç¼©è´¨é‡: {{ Math.round(uploadProgress.quality * 100) }}%</p>
                    <p>å½“å‰å¤§å°: {{ formatFileSize(uploadProgress.currentSize) }} / ç›®æ ‡: {{ formatFileSize(uploadProgress.targetSize) }}</p>
                </div>
                <el-progress :percentage="uploadProgress.progress" :show-text="false"></el-progress>
            </div>
        </el-dialog>

        <!-- ç§»åŠ¨ç«¯é”™è¯¯æ˜¾ç¤ºå¯¹è¯æ¡† -->
        <el-dialog
            title="é”™è¯¯è¯¦æƒ…"
            :visible.sync="mobileErrorDialog.visible"
            width="90%"
            :close-on-click-modal="false">
            <div style="font-family: monospace; font-size: 12px; white-space: pre-wrap; max-height: 400px; overflow-y: auto; background: #f5f5f5; padding: 10px; border-radius: 4px;">
                {{ mobileErrorDialog.content }}
            </div>
            <div slot="footer" class="dialog-footer">
                <el-button @click="copyErrorToClipboard">å¤åˆ¶é”™è¯¯ä¿¡æ¯</el-button>
                <el-button type="primary" @click="mobileErrorDialog.visible = false">å…³é—­</el-button>
            </div>
        </el-dialog>
    </div>

    <script>
        // ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½ååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–GitHubæœåŠ¡
            window.githubService = new GitHubService();

        // é…ç½®å¸¸é‡
        const contentTypes = {
            GENERAL: 'general',
            BLOG: 'blog',
            ESSAY: 'essay',
            GALLERY: 'gallery'
        };

        const contentTypeLabels = {
            [contentTypes.BLOG]: 'Blogs',
            [contentTypes.ESSAY]: 'Essays',
            [contentTypes.GALLERY]: 'Gallery'
        };

        const metadataFields = {
            [contentTypes.BLOG]: [
                { key: 'title', label: 'æ ‡é¢˜', type: 'text', required: true },
                { key: 'categories', label: 'åˆ†ç±»', type: 'tags' },
                { key: 'date', label: 'å‘å¸ƒæ—¥æœŸ', type: 'datetime' }
            ],
            [contentTypes.ESSAY]: [
                { key: 'pubDate', label: 'å‘å¸ƒæ—¥æœŸ', type: 'datetime' }
            ],
            [contentTypes.GALLERY]: [
                // Galleryæ¨¡å¼ä¸æ˜¾ç¤ºä»»ä½•å…ƒæ•°æ®å­—æ®µï¼Œdateåœ¨åå°è‡ªåŠ¨æ·»åŠ 
            ]
        };

        // æ¨¡æ¿ç”Ÿæˆå‡½æ•°
        function generateContentWithMetadata(contentType, metadata, content) {
            if (contentType === contentTypes.GENERAL) {
                return content;
            }

            const frontmatter = Object.keys(metadata)
                .filter(key => metadata[key] !== undefined && metadata[key] !== '')
                .map(key => {
                    let value = metadata[key];
                    if (key === 'categories' && typeof value === 'string') {
                        value = value.split(',').map(cat => cat.trim()).filter(cat => cat);
                    }
                    if (typeof value === 'string' && value.includes(':')) {
                        value = `"${value}"`;
                    }
                    return `${key}: ${Array.isArray(value) ? JSON.stringify(value) : value}`;
                })
                .join('\n');

            return `---\n${frontmatter}\n---\n\n${content}`;
        }

        // GitHubé…ç½®ç»„ä»¶
        Vue.component('github-config', {
            props: ['visible'],
            data() {
                return {
                    config: {
                        token: '',
                        owner: '',
                        repo: ''
                    },
                    testing: false,
                    testResult: null
                };
            },
            watch: {
                visible(newVal) {
                    if (newVal) {
                        this.loadConfig();
                    }
                }
            },
            methods: {
                loadConfig() {
                    const saved = localStorage.getItem('github-config');
                    if (saved) {
                        this.config = JSON.parse(saved);
                    }
                },
                async testConnection() {
                    if (!this.config.token || !this.config.owner || !this.config.repo) {
                        this.$message.warning('è¯·å¡«å†™å®Œæ•´çš„é…ç½®ä¿¡æ¯');
                        return;
                    }

                    this.testing = true;
                    this.testResult = null;

                    try {
                        // ä¸´æ—¶è®¾ç½®é…ç½®è¿›è¡Œæµ‹è¯•
                        const tempService = new GitHubService();
                        tempService.setConfig(this.config);

                        const result = await tempService.testConnection();

                        if (result.success) {
                            this.testResult = {
                                success: true,
                                message: `è¿æ¥æˆåŠŸï¼ç”¨æˆ·: ${result.user}ï¼Œä»“åº“: ${result.repo}ï¼Œæƒé™: ${result.permissions}`
                            };
                        } else {
                            this.testResult = {
                                success: false,
                                message: result.error
                            };
                        }
                    } catch (error) {
                        this.testResult = {
                            success: false,
                            message: `è¿æ¥å¤±è´¥: ${error.message}`
                        };
                    } finally {
                        this.testing = false;
                    }
                },
                save() {
                    if (!this.config.token || !this.config.owner || !this.config.repo) {
                        this.$message.warning('è¯·å¡«å†™å®Œæ•´çš„é…ç½®ä¿¡æ¯');
                        return;
                    }

                    localStorage.setItem('github-config', JSON.stringify(this.config));
                    this.$emit('save', this.config);
                    this.close();
                },
                close() {
                    this.$emit('close');
                }
            },
            template: `
                <el-dialog
                    title="GitHub Configuration"
                    :visible.sync="visible"
                    width="550px"
                    @close="close"
                    custom-class="github-config-dialog">
                    <el-form :model="config" label-width="140px">
                        <el-form-item label="Personal Token">
                            <el-input
                                v-model="config.token"
                                type="password"
                                placeholder="Enter your GitHub Personal Access Token"
                                show-password>
                            </el-input>
                            <div class="token-instructions">
                                <strong>How to get a token:</strong><br>
                                1. GitHub â†’ Settings â†’ Developer settings<br>
                                2. Personal access tokens â†’ Tokens (classic)<br>
                                3. Generate new token (classic)<br>
                                4. Check the <strong>repo</strong> scope â†’ Generate token<br>
                                5. Copy the token and paste it here.
                            </div>
                        </el-form-item>

                        <el-form-item label="Repository Owner">
                            <el-input
                                v-model="config.owner"
                                placeholder="Your GitHub username or organization">
                            </el-input>
                        </el-form-item>

                        <el-form-item label="Repository Name">
                            <el-input
                                v-model="config.repo"
                                placeholder="The name of the repository">
                            </el-input>
                        </el-form-item>
                    </el-form>

                    <div v-if="testResult" :class="['test-result', testResult.success ? 'success' : 'error']">
                        {{ testResult.message }}
                    </div>

                    <div slot="footer" class="dialog-footer">
                        <el-button @click="testConnection" :loading="testing">Test Connection</el-button>
                        <el-button @click="close">Cancel</el-button>
                        <el-button type="primary" @click="save" class="save-button">Save Configuration</el-button>
                    </div>
                </el-dialog>
            `
        });

        // å›¾ç‰‡æœåŠ¡é…ç½®ç»„ä»¶
        Vue.component('image-service-config', {
            props: ['visible'],
            data() {
                return {
                    config: {
                        token: '',
                        owner: '',
                        repo: '',
                        branch: 'master',  // æ”¹ä¸ºé»˜è®¤ä½¿ç”¨masteråˆ†æ”¯
                        imageDir: 'images'
                    },
                    linkRules: {
                        'GitHub': 'GitHubåŸå§‹é“¾æ¥',
                        'jsDelivr': 'jsDelivr CDN',
                        'Statically': 'Statically CDN',
                        'ChinaJsDelivr': 'ä¸­å›½jsDelivr CDN'
                    },
                    selectedLinkRule: 'jsDelivr',
                    testing: false,
                    testResult: null
                };
            },
            watch: {
                visible(newVal) {
                    if (newVal) {
                        this.loadConfig();
                    }
                }
            },
            methods: {
                loadConfig() {
                    const saved = localStorage.getItem('image-service-config');
                    if (saved) {
                        const savedConfig = JSON.parse(saved);
                        // å¼ºåˆ¶ä¿®æ­£åˆ†æ”¯é…ç½®ï¼Œå¦‚æœæ˜¯mainåˆ™æ”¹ä¸ºmaster
                        if (savedConfig.branch === 'main') {
                            savedConfig.branch = 'master';
                            localStorage.setItem('image-service-config', JSON.stringify(savedConfig));
                        }
                        this.config = { ...this.config, ...savedConfig };
                    }

                    const savedRule = localStorage.getItem('image-service-link-rule');
                    if (savedRule) {
                        this.selectedLinkRule = savedRule;
                    }
                },
                async testConnection() {
                    if (!this.config.token || !this.config.owner || !this.config.repo) {
                        this.$message.warning('è¯·å¡«å†™å®Œæ•´çš„é…ç½®ä¿¡æ¯');
                        return;
                    }

                    this.testing = true;
                    this.testResult = null;

                    try {
                        // ä¸´æ—¶è®¾ç½®é…ç½®è¿›è¡Œæµ‹è¯•
                        const tempService = new ImageService();
                        tempService.setConfig(this.config);

                        const result = await tempService.testConnection();

                        if (result.success) {
                            this.testResult = {
                                success: true,
                                message: `è¿æ¥æˆåŠŸï¼ç”¨æˆ·: ${result.user}ï¼Œä»“åº“: ${result.repo}ï¼Œæƒé™: ${result.permissions}`
                            };
                        } else {
                            this.testResult = {
                                success: false,
                                message: result.error
                            };
                        }
                    } catch (error) {
                        this.testResult = {
                            success: false,
                            message: `è¿æ¥å¤±è´¥: ${error.message}`
                        };
                    } finally {
                        this.testing = false;
                    }
                },
                save() {
                    if (!this.config.token || !this.config.owner || !this.config.repo) {
                        this.$message.warning('è¯·å¡«å†™å®Œæ•´çš„é…ç½®ä¿¡æ¯');
                        return;
                    }

                    // ä¿å­˜é…ç½®
                    const configToSave = { ...this.config };
                    localStorage.setItem('image-service-config', JSON.stringify(configToSave));
                    localStorage.setItem('image-service-link-rule', this.selectedLinkRule);

                    // è®¾ç½®CDNè§„åˆ™
                    if (window.imageService) {
                        window.imageService.setLinkRule(this.selectedLinkRule);
                    }

                    this.$emit('save', configToSave);
                    this.close();
                },
                close() {
                    this.$emit('close');
                }
            },
            template: `
                <el-dialog
                    title="å›¾åºŠé…ç½®"
                    :visible.sync="visible"
                    width="600px"
                    @close="close"
                    custom-class="github-config-dialog">
                    <el-form :model="config" label-width="120px">
                        <el-form-item label="GitHub Token">
                            <el-input
                                v-model="config.token"
                                type="password"
                                placeholder="è¾“å…¥GitHub Personal Access Token"
                                show-password>
                            </el-input>
                            <div class="token-instructions">
                                <strong>æ³¨æ„ï¼š</strong>å»ºè®®ä½¿ç”¨ä¸“é—¨çš„å›¾åºŠä»“åº“ï¼Œä¸åšå®¢ä»“åº“åˆ†å¼€ç®¡ç†
                            </div>
                        </el-form-item>

                        <el-form-item label="ä»“åº“æ‰€æœ‰è€…">
                            <el-input
                                v-model="config.owner"
                                placeholder="GitHubç”¨æˆ·åæˆ–ç»„ç»‡å">
                            </el-input>
                        </el-form-item>

                        <el-form-item label="å›¾åºŠä»“åº“å">
                            <el-input
                                v-model="config.repo"
                                placeholder="ä¸“ç”¨å›¾åºŠä»“åº“åç§°">
                            </el-input>
                        </el-form-item>

                        <el-form-item label="åˆ†æ”¯åç§°">
                            <el-input
                                v-model="config.branch"
                                placeholder="é»˜è®¤ä¸ºmaster">
                            </el-input>
                        </el-form-item>

                        <el-form-item label="å›¾ç‰‡ç›®å½•">
                            <el-input
                                v-model="config.imageDir"
                                placeholder="å›¾ç‰‡å­˜å‚¨ç›®å½•ï¼Œé»˜è®¤ä¸ºimages">
                            </el-input>
                        </el-form-item>

                        <el-form-item label="CDNæœåŠ¡">
                            <el-select v-model="selectedLinkRule" placeholder="é€‰æ‹©CDNæœåŠ¡">
                                <el-option
                                    v-for="(label, key) in linkRules"
                                    :key="key"
                                    :label="label"
                                    :value="key">
                                </el-option>
                            </el-select>
                        </el-form-item>
                    </el-form>

                    <div v-if="testResult" :class="['test-result', testResult.success ? 'success' : 'error']">
                        {{ testResult.message }}
                    </div>

                    <div slot="footer" class="dialog-footer">
                        <el-button @click="testConnection" :loading="testing">æµ‹è¯•è¿æ¥</el-button>
                        <el-button @click="close">å–æ¶ˆ</el-button>
                        <el-button type="primary" @click="save" class="save-button">ä¿å­˜é…ç½®</el-button>
                    </div>
                </el-dialog>
            `
        });

        // ä¸»Vueå®ä¾‹
        new Vue({
            el: '#app',
            data() {
                return {
                    vditor: null,
                    currentType: contentTypes.ESSAY, // é»˜è®¤ä¸ºEssaysæ¨¡å¼
                    metadata: {},
                    githubConfigVisible: false,
                    contentTypeLabels,
                    isGitHubConfigured: false,
                    isDarkMode: true,
                    metadataFields,
                    bodyContent: '',
                    hasUserInteracted: false,
                    // å›¾ç‰‡ä¸Šä¼ ç›¸å…³
                    imageConfigVisible: false,
                    isImageServiceConfigured: false,
                    uploadingImages: false,
                    uploadProgress: {
                        visible: false,
                        current: 0,
                        total: 0,
                        fileName: '',
                        stage: '',
                        progress: 0,
                        currentSize: 0,
                        targetSize: 0,
                        quality: 0
                    },
                    // ç§»åŠ¨ç«¯é”™è¯¯æ˜¾ç¤º
                    mobileErrorDialog: {
                        visible: false,
                        content: ''
                    },
                    // PWAæ¨¡å¼æ£€æµ‹
                    isPWAMode: false,
                    // Galleryæ¨¡å¼ç›¸å…³
                    galleryPreview: {
                        url: null,
                        fileName: '',
                        size: 0,
                        file: null
                    },
                    // ä¸»é¢˜ç›¸å…³
                    themeDialogVisible: false,
                    currentTheme: 'dark',
                    customColors: {
                        start: '#667eea',
                        end: '#764ba2'
                    },
                    themeOptions: [
                        { name: 'dark', label: 'ç»å…¸é»‘å¤œ', icon: 'ğŸŒ™', class: 'theme-dark', colors: ['#000000', '#1a1a1a'] },
                        { name: 'ocean', label: 'æµ·æ´‹è“', icon: 'ğŸŒŠ', class: 'theme-ocean', colors: ['#667eea', '#764ba2'] },
                        { name: 'sunset', label: 'æ—¥è½æ©™', icon: 'ğŸŒ…', class: 'theme-sunset', colors: ['#ff7e5f', '#feb47b'] },
                        { name: 'forest', label: 'æ£®æ—ç»¿', icon: 'ğŸŒ²', class: 'theme-forest', colors: ['#134e5e', '#71b280'] },
                        { name: 'purple', label: 'ç´«ç½—å…°', icon: 'ğŸ’œ', class: 'theme-purple', colors: ['#667eea', '#764ba2'] },
                        { name: 'pink', label: 'æ¨±èŠ±ç²‰', icon: 'ğŸŒ¸', class: 'theme-pink', colors: ['#ff9a9e', '#fecfef'] },
                        { name: 'blue', label: 'å¤©ç©ºè“', icon: 'â˜ï¸', class: 'theme-blue', colors: ['#a8edea', '#fed6e3'] },
                        { name: 'green', label: 'è–„è·ç»¿', icon: 'ğŸƒ', class: 'theme-green', colors: ['#d299c2', '#fef9d7'] },
                        { name: 'orange', label: 'èœœæ¡ƒæ©™', icon: 'ğŸ‘', class: 'theme-orange', colors: ['#fad0c4', '#ffd1ff'] },
                        { name: 'red', label: 'ç«ç‘°çº¢', icon: 'ğŸŒ¹', class: 'theme-red', colors: ['#ff9a9e', '#fad0c4'] },
                        { name: 'teal', label: 'é’ç»¿è‰²', icon: 'ğŸš', class: 'theme-teal', colors: ['#a8edea', '#fed6e3'] },
                        { name: 'indigo', label: 'é›è“è‰²', icon: 'ğŸ”®', class: 'theme-indigo', colors: ['#667eea', '#764ba2'] }
                    ]
                };
            },

            computed: {
                hasVisibleFields() {
                    if (!this.currentType || this.currentType === 'general' || this.currentType === 'gallery') {
                        return false;
                    }
                    const fields = this.metadataFields[this.currentType];
                    return fields && fields.length > 0;
                }
            },

            mounted() {
                this.initTheme();
                this.setupMobileDefaults();
                this.initVditor();
                this.checkGitHubConfig();
                this.checkImageServiceConfig();
                this.checkForEditFile();
                this.selectType(this.currentType);
                this.detectPWAMode();
                this.checkPWAConfigMissing();

                // ç¡®ä¿ä¸»é¢˜åœ¨é¡µé¢å®Œå…¨åŠ è½½ååº”ç”¨
                this.$nextTick(() => {
                    const savedTheme = localStorage.getItem('selected-theme');
                    if (savedTheme) {
                        try {
                            const themeData = JSON.parse(savedTheme);
                            this.applyTheme(themeData.colors);
                        } catch (e) {
                            console.log('Theme loading error:', e);
                        }
                    }
                });
            },

            methods: {
                // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
                isMobileDevice() {
                    const userAgent = navigator.userAgent.toLowerCase();
                    const mobileKeywords = ['mobile', 'android', 'iphone', 'ipad', 'ipod', 'blackberry', 'windows phone'];
                    return mobileKeywords.some(keyword => userAgent.includes(keyword)) ||
                           window.innerWidth <= 768;
                },

                // ä¸ºç§»åŠ¨è®¾å¤‡è®¾ç½®é»˜è®¤é…ç½®
                setupMobileDefaults() {
                    if (this.isMobileDevice()) {
                        // è®¾ç½®ä¸ºEssaysæ¨¡å¼
                        this.currentType = contentTypes.ESSAY;
                    }
                },

                initTheme() {
                    // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
                    const savedTheme = localStorage.getItem('selected-theme');
                    if (savedTheme) {
                        try {
                            const themeData = JSON.parse(savedTheme);
                            this.currentTheme = themeData.name;
                            this.applyTheme(themeData.colors);
                        } catch (e) {
                            // å¦‚æœè§£æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤ä¸»é¢˜
                            this.applyDefaultTheme();
                        }
                    } else {
                        this.applyDefaultTheme();
                    }
                },

                applyDefaultTheme() {
                    document.body.classList.add('dark-mode');
                    this.currentTheme = 'dark';
                    this.applyTheme(['#000000', '#1a1a1a']);
                },

                showThemeSelector() {
                    this.themeDialogVisible = true;
                },

                selectTheme(themeName, colors) {
                    this.currentTheme = themeName;
                    this.applyTheme(colors);
                    this.saveTheme(themeName, colors);
                },

                applyCustomTheme() {
                    const colors = [this.customColors.start, this.customColors.end];
                    this.currentTheme = 'custom';
                    this.applyTheme(colors);
                    this.saveTheme('custom', colors);
                },

                applyTheme(colors) {
                    const [startColor, endColor] = colors;

                    // åº”ç”¨èƒŒæ™¯æ¸å˜
                    const gradient = `linear-gradient(135deg, ${startColor} 0%, ${endColor} 100%)`;

                    // æ›´æ–°CSSå˜é‡æˆ–ç›´æ¥è®¾ç½®æ ·å¼
                    document.documentElement.style.setProperty('--theme-gradient', gradient);

                    // æ›´æ–°bodyèƒŒæ™¯
                    if (this.currentTheme === 'dark') {
                        document.body.style.background = '#000000';
                        document.body.classList.add('dark-mode');
                        document.body.classList.remove('themed-mode');
                    } else {
                        document.body.style.background = gradient;
                        document.body.classList.remove('dark-mode');
                        document.body.classList.add('themed-mode');
                    }

                    // æ›´æ–°headerèƒŒæ™¯
                    const header = document.querySelector('.header');
                    if (header) {
                        if (this.currentTheme === 'dark') {
                            header.style.background = '#000000';
                        } else {
                            header.style.background = gradient;
                        }
                    }

                    // æ›´æ–°ç¼–è¾‘å™¨å®¹å™¨èƒŒæ™¯
                    const editorContainer = document.querySelector('.editor-container');
                    if (editorContainer) {
                        if (this.currentTheme === 'dark') {
                            editorContainer.style.background = '#000000';
                        } else {
                            // ä¸ºç¼–è¾‘å™¨ä½¿ç”¨æ›´æµ…çš„èƒŒæ™¯
                            editorContainer.style.background = `linear-gradient(135deg, ${this.lightenColor(startColor, 0.95)} 0%, ${this.lightenColor(endColor, 0.95)} 100%)`;
                        }
                    }

                    // æ›´æ–°Vditorç¼–è¾‘å™¨èƒŒæ™¯ï¼ˆå»¶è¿Ÿæ‰§è¡Œç¡®ä¿ç¼–è¾‘å™¨å·²åŠ è½½ï¼‰
                    setTimeout(() => {
                        const vditorElements = [
                            '.vditor-toolbar',
                            '.vditor-content',
                            '.vditor-wysiwyg',
                            '.vditor-ir',
                            '.vditor-sv'
                        ];

                        vditorElements.forEach(selector => {
                            const elements = document.querySelectorAll(selector);
                            elements.forEach(el => {
                                if (this.currentTheme === 'dark') {
                                    el.style.background = '#000000';
                                } else {
                                    el.style.background = `rgba(255,255,255,0.1)`;
                                    el.style.backdropFilter = 'blur(10px)';
                                }
                            });
                        });
                    }, 100);
                },

                lightenColor(color, factor) {
                    // ç®€å•çš„é¢œè‰²å˜äº®å‡½æ•°
                    const hex = color.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);

                    const newR = Math.min(255, Math.floor(r + (255 - r) * factor));
                    const newG = Math.min(255, Math.floor(g + (255 - g) * factor));
                    const newB = Math.min(255, Math.floor(b + (255 - b) * factor));

                    return `#${newR.toString(16).padStart(2, '0')}${newG.toString(16).padStart(2, '0')}${newB.toString(16).padStart(2, '0')}`;
                },

                saveTheme(themeName, colors) {
                    const themeData = {
                        name: themeName,
                        colors: colors,
                        timestamp: Date.now()
                    };
                    localStorage.setItem('selected-theme', JSON.stringify(themeData));
                },

                resetToDefault() {
                    localStorage.removeItem('selected-theme');
                    this.applyDefaultTheme();
                    this.themeDialogVisible = false;
                    this.$message.success('å·²æ¢å¤é»˜è®¤ä¸»é¢˜');
                },

                initVditor() {
                    const editorMode = 'ir';
                    this.vditor = new Vditor('vditor', {
                        height: '100%',
                        mode: editorMode,
                        theme: 'dark',
                        preview: {
                            theme: { current: 'dark' },
                            actions: []
                        },
                        toolbar: [
                            'emoji', 'headings', 'bold', 'italic', 'strike', 'link', '|',
                            'list', 'ordered-list', 'check', 'outdent', 'indent', '|',
                            'quote', 'line', 'code', 'inline-code', 'insert-before', 'insert-after', '|',
                            'upload', 'table', '|',
                            'undo', 'redo', '|',
                            'edit-mode', 'content-theme', 'code-theme', '|',
                            'outline', 'preview', 'fullscreen'
                        ],
                        upload: {
                            accept: 'image/*',
                            multiple: true,
                            fieldName: 'file[]',
                            filename: (name) => name.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5\.)]/g, ''),
                            handler: (files) => {
                                return this.handleImageUpload(files);
                            }
                        },
                        cache: { enable: false },
                        after: function() {

                            // å°†å…ƒæ•°æ®ç¼–è¾‘å™¨ç§»åŠ¨åˆ°å·¥å…·æ ä¸‹æ–¹
                            const vditorElement = document.getElementById('vditor');
                            const toolbar = vditorElement.querySelector('.vditor-toolbar');
                            const metadataEditor = document.getElementById('metadata-editor-wrapper');
                            if (toolbar && metadataEditor) {
                                toolbar.insertAdjacentElement('afterend', metadataEditor);
                                metadataEditor.style.display = 'block';
                            }

                            // ç»‘å®š input äº‹ä»¶ï¼Œå°†ç¼–è¾‘å™¨å†…å®¹åŒæ­¥åˆ° bodyContent
                            this.vditor.vditor.element.addEventListener('input', () => {
                                this.bodyContent = this.vditor.getValue();
                            });

                            // è®¾ç½®æ‹–æ‹½å’Œç²˜è´´æ”¯æŒ
                            this.setupImageDragAndPaste();

                            // ç¼–è¾‘å™¨åˆå§‹åŒ–å®Œæˆåï¼Œè§¦å‘è‡ªåŠ¨èšç„¦
                            this.$nextTick(() => {
                                if (this.isMobileDevice()) {
                                    this.setupMobileAutoFocus();
                                } else {
                                    this.setupDesktopAutoFocus();
                                }
                            });
                        }.bind(this)
                    });
                },

                checkGitHubConfig() {
                    const config = localStorage.getItem('github-config');
                    this.isGitHubConfigured = !!config;
                    if (config && window.githubService) {
                        const parsedConfig = JSON.parse(config);
                        window.githubService.setConfig(parsedConfig);
                    }
                },

                checkForEditFile() {
                    const urlParams = new URLSearchParams(window.location.search);
                    const editFile = urlParams.get('edit');
                    if (editFile) {
                        this.loadFileForEdit(editFile);
                    }
                },

                async loadFileForEdit(filePath) {
                    if (!this.isGitHubConfigured) {
                        this.$message.warning('è¯·å…ˆé…ç½®GitHub');
                        return;
                    }
                    try {
                        this.$message({ message: 'æ­£åœ¨åŠ è½½æ–‡ä»¶...', type: 'info' });
                        const fileData = await window.githubService.getFile(filePath);
                        if (fileData) {
                            const { metadata, content } = this.parseContentWithFrontmatter(fileData.content);
                            
                            if (filePath.includes('/posts/')) {
                                this.currentType = contentTypes.BLOG;
                            } else if (filePath.includes('/essays/')) {
                                this.currentType = contentTypes.ESSAY;
                            }
                            
                            this.metadata = metadata;
                            this.bodyContent = content;
                            this.vditor.setValue(content);
                            this.$message.success('æ–‡ä»¶åŠ è½½æˆåŠŸ');
                        }
                    } catch (error) {
                        this.$message.error(`åŠ è½½æ–‡ä»¶å¤±è´¥: ${error.message}`);
                    }
                },

                getTypeIcon(type) {
                    const icons = {
                        [contentTypes.BLOG]: 'el-icon-document',
                        [contentTypes.ESSAY]: 'el-icon-edit-outline',
                        [contentTypes.GALLERY]: 'el-icon-picture'
                    };
                    return icons[type] || 'el-icon-document';
                },

                selectType(type) {
                    this.currentType = type;
                    this.resetMetadata(type);
                    this.bodyContent = '';
                    this.vditor.setValue('');

                    // Galleryæ¨¡å¼é‡ç½®é¢„è§ˆ
                    if (type === contentTypes.GALLERY) {
                        this.resetGalleryPreview();
                    }
                },

                resetMetadata(type) {
                    const now = new Date();
                    let newMeta = {};

                    if (type === contentTypes.BLOG) {
                        const dateStr = now.toISOString().split('T')[0];
                        newMeta = {
                            title: '',
                            categories: 'Daily',
                            pubDate: dateStr
                        };
                    } else if (type === contentTypes.ESSAY) {
                        const dateTimeStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
                        newMeta = {
                            pubDate: dateTimeStr
                        };
                    } else if (type === contentTypes.GALLERY) {
                        const dateStr = now.toISOString().split('T')[0];
                        newMeta = {
                            date: dateStr
                        };
                    }
                    this.metadata = newMeta;
                },

                setCursorToPosition(position) {
                    try {
                        // æ–¹æ³•1: å°è¯•ä½¿ç”¨Vditorçš„API
                        if (this.vditor.setCursorPosition) {
                            this.vditor.setCursorPosition(position);
                            return;
                        }
                    } catch (e) {
                        // Vditor API method failed, trying direct DOM manipulation
                    }

                    // æ–¹æ³•2: ç›´æ¥æ“ä½œDOMå…ƒç´ 
                    const editor = this.vditor.vditor.element.querySelector('.vditor-textarea') ||
                                 this.vditor.vditor.element.querySelector('textarea') ||
                                 this.vditor.vditor.element.querySelector('.vditor-ir');

                    if (editor) {
                        if (editor.setSelectionRange) {
                            editor.setSelectionRange(position, position);
                            editor.focus();
                        } else if (editor.createTextRange) {
                            // IEå…¼å®¹
                            const range = editor.createTextRange();
                            range.move('character', position);
                            range.select();
                        }
                    }
                },

                parseContentWithFrontmatter(content) {
                    // æ£€æŸ¥æ˜¯å¦æœ‰frontmatter
                    if (!content.startsWith('---')) {
                        return { metadata: {}, content: content };
                    }

                    const lines = content.split('\n');
                    let frontmatterEnd = -1;

                    // æ‰¾åˆ°frontmatterç»“æŸä½ç½®
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim() === '---') {
                            frontmatterEnd = i;
                            break;
                        }
                    }

                    if (frontmatterEnd === -1) {
                        return { metadata: {}, content: content };
                    }

                    // æå–frontmatter
                    const frontmatterLines = lines.slice(1, frontmatterEnd);
                    const bodyContent = lines.slice(frontmatterEnd + 1).join('\n');

                    // è§£æfrontmatter
                    const metadata = {};
                    frontmatterLines.forEach(line => {
                        const colonIndex = line.indexOf(':');
                        if (colonIndex > 0) {
                            const key = line.substring(0, colonIndex).trim();
                            let value = line.substring(colonIndex + 1).trim();

                            // å¤„ç†ç©ºå€¼
                            if (!value || value.trim() === '') {
                                value = '';
                            } else {
                                // ç§»é™¤å¼•å·
                                if ((value.startsWith('"') && value.endsWith('"')) ||
                                    (value.startsWith("'") && value.endsWith("'"))) {
                                    value = value.slice(1, -1);
                                }

                                // å¤„ç†æ•°ç»„æ ¼å¼
                                if (value.startsWith('[') && value.endsWith(']')) {
                                    try {
                                        value = JSON.parse(value);
                                    } catch (e) {
                                        // å¦‚æœè§£æå¤±è´¥ï¼Œä¿æŒåŸå€¼
                                    }
                                }
                            }

                            metadata[key] = value;
                        }
                    });

                    return { metadata, content: bodyContent };
                },

                async publish() {
                    if (!this.isGitHubConfigured) {
                        this.$message.warning('è¯·å…ˆé…ç½®GitHub');
                        return;
                    }

                    // Galleryæ¨¡å¼ç‰¹æ®Šå¤„ç†
                    if (this.currentType === contentTypes.GALLERY) {
                        return await this.publishGalleryImage();
                    }

                    // ä»ç¼–è¾‘å™¨è·å–æœ€æ–°çš„æ­£æ–‡
                    this.bodyContent = this.vditor.getValue();

                    // æ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹ï¼ˆæ­£æ–‡ä¸èƒ½ä¸ºç©ºï¼‰
                    if (!this.bodyContent.trim()) {
                        this.$message.warning('è¯·å…ˆç¼–å†™å†…å®¹');
                        return;
                    }

                    if (this.currentType === contentTypes.BLOG && !this.metadata.title) {
                        this.$message.warning('è¯·å…ˆè®¾ç½®æ ‡é¢˜');
                        return;
                    }

                    const finalContent = generateContentWithMetadata(this.currentType, this.metadata, this.bodyContent);

                    // è·å–å‘å¸ƒæŒ‰é’®å…ƒç´ 
                    const publishButton = document.querySelector('.publish-button');

                    try {
                        this.$message({ message: 'æ­£åœ¨å‘å¸ƒ...', type: 'info' });

                        const result = await window.githubService.publishContent(
                            this.currentType,
                            this.metadata,
                            finalContent
                        );

                        if (result.success) {
                            // æ·»åŠ æˆåŠŸçŠ¶æ€åŠ¨ç”»
                            if (publishButton) {
                                publishButton.classList.add('success');

                                // 1.5ç§’åç§»é™¤æˆåŠŸçŠ¶æ€
                                setTimeout(() => {
                                    publishButton.classList.remove('success');
                                }, 1500);
                            }

                            this.$message({
                                message: `å‘å¸ƒæˆåŠŸï¼æ–‡ä»¶å·²${result.action === 'add' ? 'åˆ›å»º' : 'æ›´æ–°'}`,
                                type: 'success'
                            });

                            this.selectType(this.currentType); // é‡ç½®
                        }
                    } catch (error) {
                        console.error('å‘å¸ƒå¤±è´¥:', error);
                        this.$message.error(`å‘å¸ƒå¤±è´¥: ${error.message}`);
                    }
                },

                configureGitHub() {
                    this.githubConfigVisible = true;
                },

                handleGitHubConfigSave(config) {
                    if (window.githubService) {
                        window.githubService.setConfig(config);
                        this.checkGitHubConfig();
                        this.$message.success('GitHubé…ç½®å·²ä¿å­˜');
                    }
                },

                // ç”µè„‘ç«¯è‡ªåŠ¨èšç„¦
                setupDesktopAutoFocus() {
                    // å¤šæ¬¡å°è¯•èšç„¦ï¼Œç¡®ä¿æˆåŠŸ
                    const attemptFocus = (attempt = 1) => {
                        this.focusEditor();

                        // æ£€æŸ¥æ˜¯å¦æˆåŠŸèšç„¦
                        setTimeout(() => {
                            const editorElement = this.vditor?.vditor?.ir?.element;
                            const isEditorFocused = document.activeElement === editorElement ||
                                                  editorElement?.contains(document.activeElement);

                            // å¦‚æœæ²¡æœ‰èšç„¦æˆåŠŸä¸”å°è¯•æ¬¡æ•°å°‘äº5æ¬¡ï¼Œç»§ç»­å°è¯•
                            if (!isEditorFocused && attempt < 5) {
                                attemptFocus(attempt + 1);
                            }
                        }, 300);
                    };

                    // ç«‹å³å°è¯•èšç„¦
                    setTimeout(() => attemptFocus(), 100);

                    // å†æ¬¡å°è¯•ï¼ˆç¡®ä¿ç¼–è¾‘å™¨å®Œå…¨åŠ è½½ï¼‰
                    setTimeout(() => attemptFocus(), 500);

                    // æœ€åä¸€æ¬¡å°è¯•
                    setTimeout(() => attemptFocus(), 1000);
                },

                // ç§»åŠ¨ç«¯è‡ªåŠ¨èšç„¦
                setupMobileAutoFocus() {
                    if (!this.isMobileDevice()) return;

                    // å¤šæ¬¡å°è¯•èšç„¦ï¼Œç¡®ä¿æˆåŠŸ
                    const attemptFocus = (attempt = 1) => {
                        this.focusEditor();

                        // æ£€æŸ¥æ˜¯å¦æˆåŠŸèšç„¦
                        setTimeout(() => {
                            const editorElement = this.vditor?.vditor?.ir?.element;
                            const isEditorFocused = document.activeElement === editorElement ||
                                                  editorElement?.contains(document.activeElement);

                            // å¦‚æœæ²¡æœ‰èšç„¦æˆåŠŸä¸”å°è¯•æ¬¡æ•°å°‘äº5æ¬¡ï¼Œç»§ç»­å°è¯•
                            if (!isEditorFocused && attempt < 5) {
                                attemptFocus(attempt + 1);
                            }
                        }, 300);
                    };

                    // ç«‹å³å°è¯•èšç„¦
                    setTimeout(() => attemptFocus(), 100);

                    // å†æ¬¡å°è¯•ï¼ˆç¡®ä¿ç¼–è¾‘å™¨å®Œå…¨åŠ è½½ï¼‰
                    setTimeout(() => attemptFocus(), 500);

                    // æœ€åä¸€æ¬¡å°è¯•
                    setTimeout(() => attemptFocus(), 1000);
                },



                // èšç„¦ç¼–è¾‘å™¨
                focusEditor() {
                    if (!this.vditor || !this.vditor.vditor || !this.vditor.vditor.ir) {
                        // å¦‚æœç¼–è¾‘å™¨è¿˜æ²¡å‡†å¤‡å¥½ï¼Œç¨åé‡è¯•
                        setTimeout(() => this.focusEditor(), 200);
                        return;
                    }

                    try {
                        // ä½¿ç”¨Vditorçš„å†…ç½®èšç„¦æ–¹æ³•
                        this.vditor.focus();

                        // è·å–ç¼–è¾‘å™¨çš„æ–‡æœ¬åŒºåŸŸ
                        const editorElement = this.vditor.vditor.ir.element;
                        if (editorElement) {
                            // ç¡®ä¿ç¼–è¾‘å™¨è·å¾—ç„¦ç‚¹
                            editorElement.focus();

                            // è§¦å‘ç‚¹å‡»äº‹ä»¶ä»¥ç¡®ä¿å…‰æ ‡æ˜¾ç¤º
                            const clickEvent = new MouseEvent('click', {
                                view: window,
                                bubbles: true,
                                cancelable: true
                            });
                            editorElement.dispatchEvent(clickEvent);

                            // å°†å…‰æ ‡ç§»åˆ°å†…å®¹æœ«å°¾
                            setTimeout(() => {
                                const range = document.createRange();
                                const selection = window.getSelection();

                                if (editorElement.childNodes.length > 0) {
                                    // æ‰¾åˆ°æœ€åä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹
                                    let lastNode = editorElement;
                                    while (lastNode.lastChild) {
                                        lastNode = lastNode.lastChild;
                                    }

                                    if (lastNode.nodeType === Node.TEXT_NODE) {
                                        range.setStart(lastNode, lastNode.textContent.length);
                                        range.setEnd(lastNode, lastNode.textContent.length);
                                    } else {
                                        range.selectNodeContents(editorElement);
                                        range.collapse(false);
                                    }
                                } else {
                                    range.setStart(editorElement, 0);
                                    range.setEnd(editorElement, 0);
                                }

                                selection.removeAllRanges();
                                selection.addRange(range);

                                // ç¡®ä¿å…‰æ ‡å¯è§
                                editorElement.focus();
                            }, 100);

                            // æ»šåŠ¨åˆ°ç¼–è¾‘å™¨ä½ç½®
                            setTimeout(() => {
                                editorElement.scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'center'
                                });
                            }, 200);
                        }
                    } catch (error) {
                        console.log('èšç„¦ç¼–è¾‘å™¨å¤±è´¥:', error);
                        // å¤‡ç”¨æ–¹æ¡ˆï¼šç›´æ¥èšç„¦ç¼–è¾‘å™¨å®¹å™¨
                        try {
                            const vditorContainer = document.querySelector('#vditor .vditor-ir pre');
                            if (vditorContainer) {
                                vditorContainer.focus();
                            }
                        } catch (e) {
                            console.log('å¤‡ç”¨èšç„¦æ–¹æ¡ˆä¹Ÿå¤±è´¥:', e);
                        }
                    }
                },

                // æ£€æŸ¥å›¾ç‰‡æœåŠ¡é…ç½®
                checkImageServiceConfig() {
                    this.isImageServiceConfigured = window.imageService && window.imageService.isConfigured();
                },

                // æ£€æµ‹PWAæ¨¡å¼
                detectPWAMode() {
                    this.isPWAMode = window.navigator.standalone === true ||
                                     window.matchMedia('(display-mode: standalone)').matches;
                },

                // æ£€æŸ¥PWAæ¨¡å¼ä¸‹é…ç½®ç¼ºå¤±çš„æƒ…å†µ
                checkPWAConfigMissing() {
                    // æ£€æµ‹æ˜¯å¦ä¸ºPWAæ¨¡å¼ï¼ˆä¿å­˜åˆ°ä¸»å±å¹•ï¼‰
                    const isPWA = window.navigator.standalone === true ||
                                  window.matchMedia('(display-mode: standalone)').matches;

                    if (isPWA) {
                        // å»¶è¿Ÿæ£€æŸ¥ï¼Œç¡®ä¿æ‰€æœ‰ç»„ä»¶éƒ½å·²åˆå§‹åŒ–
                        setTimeout(() => {
                            const hasImageConfig = localStorage.getItem('image-service-config');
                            const hasGitHubConfig = localStorage.getItem('github-config');

                            if (!hasImageConfig || !hasGitHubConfig) {
                                this.showPWAConfigDialog();
                            }
                        }, 1000);
                    }
                },

                showPWAConfigDialog() {
                    this.$confirm(
                        'PWAæ¨¡å¼ä¸‹éœ€è¦é‡æ–°é…ç½®ã€‚è¿™æ˜¯å› ä¸ºPWAå’Œæµè§ˆå™¨ä½¿ç”¨ä¸åŒçš„å­˜å‚¨ç©ºé—´ã€‚æ˜¯å¦ç°åœ¨é…ç½®ï¼Ÿ',
                        'PWAé…ç½®æé†’',
                        {
                            confirmButtonText: 'ç«‹å³é…ç½®',
                            cancelButtonText: 'ç¨åé…ç½®',
                            type: 'info',
                            customClass: 'pwa-config-dialog'
                        }
                    ).then(() => {
                        // ä¼˜å…ˆé…ç½®å›¾ç‰‡æœåŠ¡
                        this.imageConfigVisible = true;
                    }).catch(() => {
                        // ç”¨æˆ·é€‰æ‹©ç¨åé…ç½®ï¼Œæ˜¾ç¤ºæç¤º
                        this.$message({
                            message: 'æç¤ºï¼šå›¾ç‰‡ä¸Šä¼ åŠŸèƒ½éœ€è¦å…ˆé…ç½®GitHubä»“åº“ä¿¡æ¯',
                            type: 'warning',
                            duration: 5000
                        });
                    });
                },

                // å¿«é€Ÿé…ç½®åŠŸèƒ½ï¼ˆç”¨äºPWAæ¨¡å¼ï¼‰
                showQuickConfig() {
                    this.$prompt('è¯·è¾“å…¥GitHub Token:', 'å¿«é€Ÿé…ç½®', {
                        confirmButtonText: 'ç¡®å®š',
                        cancelButtonText: 'å–æ¶ˆ',
                        inputType: 'password',
                        inputPlaceholder: 'è¯·è¾“å…¥æ‚¨çš„GitHub Personal Access Token'
                    }).then(({ value }) => {
                        if (value) {
                            this.applyQuickConfig(value);
                        }
                    }).catch(() => {
                        this.$message.info('å·²å–æ¶ˆé…ç½®');
                    });
                },

                applyQuickConfig(token) {
                    // ä½¿ç”¨é¢„è®¾çš„é…ç½®ä¿¡æ¯
                    const imageConfig = {
                        token: token,
                        owner: 'SUNSIR007',
                        repo: 'picx-images-hosting',
                        branch: 'master',
                        imageDir: 'images'
                    };

                    const githubConfig = {
                        token: token,
                        owner: 'SUNSIR007',
                        repo: 'markdown-online-editor'
                    };

                    // ä¿å­˜é…ç½®
                    localStorage.setItem('image-service-config', JSON.stringify(imageConfig));
                    localStorage.setItem('github-config', JSON.stringify(githubConfig));
                    localStorage.setItem('image-service-link-rule', 'jsdelivr');

                    // åº”ç”¨é…ç½®
                    if (window.imageService) {
                        window.imageService.setConfig(imageConfig);
                        window.imageService.setLinkRule('jsdelivr');
                    }
                    if (window.githubService) {
                        window.githubService.setConfig(githubConfig);
                    }

                    // æ›´æ–°çŠ¶æ€
                    this.checkGitHubConfig();
                    this.checkImageServiceConfig();

                    this.$message.success('å¿«é€Ÿé…ç½®å®Œæˆï¼');
                },

                // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
                async handleImageUpload(files) {
                    if (!this.isImageServiceConfigured) {
                        this.$message.warning('è¯·å…ˆé…ç½®å›¾åºŠæœåŠ¡');
                        return Promise.reject('å›¾åºŠæœªé…ç½®');
                    }

                    const fileArray = Array.from(files);
                    this.uploadingImages = true;
                    this.uploadProgress.visible = true;
                    this.uploadProgress.total = fileArray.length;

                    // æ¸…é™¤æ‹–æ‹½è§†è§‰æ•ˆæœ
                    const vditorElement = document.getElementById('vditor');
                    if (vditorElement) {
                        vditorElement.classList.remove('drag-over');
                    }

                    // ç§»åŠ¨ç«¯è°ƒè¯•ä¿¡æ¯
                    if (this.isMobileDevice()) {
                        console.log('ç§»åŠ¨ç«¯ä¸Šä¼ å¼€å§‹:', {
                            fileCount: fileArray.length,
                            files: fileArray.map(f => ({ name: f.name, size: f.size, type: f.type })),
                            userAgent: navigator.userAgent,
                            imageServiceConfig: {
                                owner: window.imageService?.owner,
                                repo: window.imageService?.repo,
                                branch: window.imageService?.branch,
                                isConfigured: window.imageService?.isConfigured()
                            }
                        });
                    }

                    try {
                        const results = await window.imageService.uploadImages(fileArray, {
                            compress: true,
                            quality: 0.8,
                            addHash: true,
                            onProgress: (progress) => {
                                this.uploadProgress.current = progress.current;
                                this.uploadProgress.fileName = progress.fileName;
                                this.uploadProgress.stage = progress.stage;
                                this.uploadProgress.progress = progress.singleProgress || 0;
                                this.uploadProgress.currentSize = progress.currentSize || 0;
                                this.uploadProgress.targetSize = progress.targetSize || 0;
                                this.uploadProgress.quality = progress.quality || 0;
                            },
                            onSingleComplete: (result, index) => {
                                if (result.success) {
                                    // æ’å…¥Markdownå›¾ç‰‡è¯­æ³•åˆ°ç¼–è¾‘å™¨
                                    const imageMarkdown = `![${result.fileName}](${result.url})\n`;
                                    this.insertTextToEditor(imageMarkdown);
                                    this.$message.success(`å›¾ç‰‡ ${result.fileName} ä¸Šä¼ æˆåŠŸ`);
                                } else {
                                    this.$message.error(`å›¾ç‰‡ ${result.fileName} ä¸Šä¼ å¤±è´¥: ${result.error}`);
                                    // ç§»åŠ¨ç«¯é¢å¤–é”™è¯¯ä¿¡æ¯
                                    if (this.isMobileDevice()) {
                                        console.error('ç§»åŠ¨ç«¯ä¸Šä¼ å¤±è´¥è¯¦æƒ…:', result);
                                    }
                                }
                            }
                        });

                        const successCount = results.filter(r => r.success).length;
                        const failCount = results.length - successCount;

                        if (successCount > 0) {
                            this.$message.success(`æˆåŠŸä¸Šä¼  ${successCount} å¼ å›¾ç‰‡${failCount > 0 ? `ï¼Œ${failCount} å¼ å¤±è´¥` : ''}`);
                        }

                        return Promise.resolve(results);

                    } catch (error) {
                        console.error('å›¾ç‰‡ä¸Šä¼ é”™è¯¯:', error);
                        // ç§»åŠ¨ç«¯æ˜¾ç¤ºè¯¦ç»†é”™è¯¯å¯¹è¯æ¡†
                        if (this.isMobileDevice()) {
                            this.showMobileError(error, 'å›¾ç‰‡ä¸Šä¼ ');
                        } else {
                            this.$message.error(`å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ${error.message}`);
                        }
                        return Promise.reject(error);
                    } finally {
                        this.uploadingImages = false;
                        this.uploadProgress.visible = false;
                    }
                },

                // æ’å…¥æ–‡æœ¬åˆ°ç¼–è¾‘å™¨
                insertTextToEditor(text) {
                    if (this.vditor) {
                        this.vditor.insertValue(text);
                    }
                },

                // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
                isMobileDevice() {
                    return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                },

                // æ˜¾ç¤ºç§»åŠ¨ç«¯é”™è¯¯è¯¦æƒ…
                showMobileError(error, context = '') {
                    if (this.isMobileDevice()) {
                        const errorInfo = {
                            æ—¶é—´: new Date().toLocaleString(),
                            é”™è¯¯: error.message || error,
                            ä¸Šä¸‹æ–‡: context,
                            ç”¨æˆ·ä»£ç†: navigator.userAgent,
                            URL: window.location.href,
                            å›¾åºŠé…ç½®: window.imageService ? {
                                owner: window.imageService.owner,
                                repo: window.imageService.repo,
                                branch: window.imageService.branch,
                                å·²é…ç½®: window.imageService.isConfigured()
                            } : 'æœªåˆå§‹åŒ–'
                        };

                        this.mobileErrorDialog.content = JSON.stringify(errorInfo, null, 2);
                        this.mobileErrorDialog.visible = true;
                    }
                },

                // å¤åˆ¶é”™è¯¯ä¿¡æ¯åˆ°å‰ªè´´æ¿
                async copyErrorToClipboard() {
                    try {
                        await navigator.clipboard.writeText(this.mobileErrorDialog.content);
                        this.$message.success('é”™è¯¯ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    } catch (err) {
                        // é™çº§æ–¹æ¡ˆ
                        const textArea = document.createElement('textarea');
                        textArea.value = this.mobileErrorDialog.content;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        this.$message.success('é”™è¯¯ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    }
                },

                // è®¾ç½®å›¾ç‰‡æ‹–æ‹½å’Œç²˜è´´æ”¯æŒ
                setupImageDragAndPaste() {
                    const vditorElement = document.getElementById('vditor');
                    if (!vditorElement) return;

                    // æ‹–æ‹½æ”¯æŒ
                    vditorElement.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        vditorElement.classList.add('drag-over');
                    });

                    vditorElement.addEventListener('dragleave', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        vditorElement.classList.remove('drag-over');
                    });

                    vditorElement.addEventListener('drop', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        vditorElement.classList.remove('drag-over');

                        const files = Array.from(e.dataTransfer.files).filter(file =>
                            file.type.startsWith('image/')
                        );

                        if (files.length > 0) {
                            this.handleImageUpload(files);
                        }
                    });

                    // ç²˜è´´æ”¯æŒ
                    vditorElement.addEventListener('paste', (e) => {
                        const items = Array.from(e.clipboardData.items);
                        const imageItems = items.filter(item => item.type.startsWith('image/'));

                        if (imageItems.length > 0) {
                            e.preventDefault();
                            const files = imageItems.map(item => item.getAsFile()).filter(file => file);
                            if (files.length > 0) {
                                this.handleImageUpload(files);
                            }
                        }
                    });
                },

                // é…ç½®å›¾ç‰‡æœåŠ¡
                configureImageService() {
                    this.imageConfigVisible = true;
                },

                // å¤„ç†å›¾ç‰‡æœåŠ¡é…ç½®ä¿å­˜
                handleImageServiceConfigSave(config) {
                    if (window.imageService) {
                        window.imageService.setConfig(config);
                        this.checkImageServiceConfig();
                        this.$message.success('å›¾åºŠé…ç½®å·²ä¿å­˜');
                    }
                },

                // Galleryç›¸å…³æ–¹æ³•
                resetGalleryPreview() {
                    this.galleryPreview = {
                        url: null,
                        fileName: '',
                        size: 0,
                        file: null
                    };
                },

                // è·å–é˜¶æ®µæ–‡æœ¬
                getStageText(stage) {
                    const stageTexts = {
                        'preparing': 'å‡†å¤‡ä¸­...',
                        'analyzing': 'åˆ†æå›¾ç‰‡...',
                        'compressing': 'æ™ºèƒ½å‹ç¼©ä¸­...',
                        'converting': 'è½¬æ¢ä¸­...',
                        'uploading': 'ä¸Šä¼ ä¸­...',
                        'generating': 'ç”Ÿæˆé“¾æ¥...',
                        'finalizing': 'å®Œæˆå¤„ç†...',
                        'completed': 'å®Œæˆ'
                    };
                    return stageTexts[stage] || 'å¤„ç†ä¸­...';
                },

                // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
                formatFileSize(bytes) {
                    if (bytes === 0) return '0 Bytes';
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                },

                async publishGalleryImage() {
                    // ä»ç¼–è¾‘å™¨å†…å®¹ä¸­æå–å›¾ç‰‡URL
                    const content = this.vditor.getValue();
                    const imageUrlMatch = content.match(/!\[.*?\]\((https?:\/\/[^\)]+)\)/);

                    if (!imageUrlMatch) {
                        this.$message.warning('è¯·å…ˆåœ¨ç¼–è¾‘å™¨ä¸­ä¸Šä¼ å›¾ç‰‡');
                        return;
                    }

                    const imageUrl = imageUrlMatch[1];

                    const publishButton = document.querySelector('.publish-button');

                    try {
                        this.$message({ message: 'æ­£åœ¨ä¿å­˜å›¾ç‰‡ä¿¡æ¯...', type: 'info' });

                        // åˆ›å»ºå›¾ç‰‡æ•°æ®
                        const imageData = {
                            url: imageUrl,
                            thumbnail: imageUrl, // ä½¿ç”¨åŒä¸€ä¸ªURLä½œä¸ºç¼©ç•¥å›¾
                            date: this.metadata.date
                        };

                        // ç”Ÿæˆæ–‡ä»¶åï¼ˆä½¿ç”¨æ—¶é—´æˆ³ï¼‰
                        const fileName = this.generateGalleryFileName();
                        const filePath = `src/content/photos/${fileName}.json`;

                        // ä¿å­˜JSONæ–‡ä»¶åˆ°GitHub
                        const jsonContent = JSON.stringify(imageData, null, 2);
                        const result = await window.githubService.createOrUpdateFile(
                            filePath,
                            jsonContent,
                            `Add gallery image: ${fileName}`
                        );

                        if (publishButton) {
                            publishButton.classList.add('success');
                            setTimeout(() => {
                                publishButton.classList.remove('success');
                            }, 1500);
                        }

                        this.$message({
                            message: 'å›¾ç‰‡å‘å¸ƒæˆåŠŸï¼',
                            type: 'success'
                        });

                        this.selectType(this.currentType); // é‡ç½®

                    } catch (error) {
                        console.error('å‘å¸ƒå¤±è´¥:', error);
                        this.$message.error(`å‘å¸ƒå¤±è´¥: ${error.message}`);
                    }
                },

                generateGalleryFileName() {
                    // ä½¿ç”¨æ—¶é—´æˆ³ç”Ÿæˆæ–‡ä»¶å
                    const now = new Date();
                    const timestamp = now.getTime();
                    const dateStr = now.toISOString().split('T')[0]; // YYYY-MM-DD
                    return `photo-${dateStr}-${timestamp}`;
                }
            }
        });

        }); // ç»“æŸDOMContentLoadedäº‹ä»¶ç›‘å¬å™¨
    </script>
</body>
</html>
