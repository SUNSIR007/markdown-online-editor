<!DOCTYPE html>
<html lang="zh-CN" style="background:#000000 !important;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- ğŸ”¥ å…³é”®ä¿®å¤ï¼šç«‹å³æ‰§è¡Œçš„ä¸»é¢˜åˆå§‹åŒ–è„šæœ¬ - å¿…é¡»åœ¨ä»»ä½•æ¸²æŸ“ä¹‹å‰ -->
    <script>
        // ç«‹å³æ‰§è¡Œï¼Œä¸ç­‰å¾…ä»»ä½•äº‹ä»¶
        (function() {
            // å¼ºåˆ¶è®¾ç½®é»‘è‰²èƒŒæ™¯ï¼Œé˜²æ­¢iOS PWAç™½å±
            document.documentElement.style.cssText = 'background-color: #000000 !important; background: #000000 !important;';
            document.documentElement.style.backgroundColor = '#000000';

            // åˆ›å»ºå¹¶ç«‹å³åº”ç”¨æ ·å¼
            const styleElement = document.createElement('style');
            styleElement.id = 'emergency-dark-theme';
            styleElement.textContent = `
                html, body {
                    background-color: #000000 !important;
                    background: #000000 !important;
                    color: #e0e0e0 !important;
                }
                #app, .header, .content-type-selector, .editor-container {
                    background-color: #000000 !important;
                }
            `;

            // ä½¿ç”¨ insertBefore ç¡®ä¿æ ·å¼ç«‹å³ç”Ÿæ•ˆ
            const firstChild = document.head.firstChild;
            if (firstChild) {
                document.head.insertBefore(styleElement, firstChild);
            } else {
                document.head.appendChild(styleElement);
            }

            // ç›‘å¬bodyçš„åˆ›å»ºï¼Œç«‹å³è®¾ç½®é»‘è‰²
            if (!document.body) {
                const observer = new MutationObserver(function(mutations) {
                    if (document.body) {
                        document.body.style.cssText = 'background-color: #000000 !important; color: #e0e0e0 !important; margin: 0 !important; padding: 0 !important;';
                        document.body.classList.add('theme-dark');
                        observer.disconnect();
                    }
                });
                observer.observe(document.documentElement, { childList: true, subtree: true });
            } else {
                document.body.style.cssText = 'background-color: #000000 !important; color: #e0e0e0 !important; margin: 0 !important; padding: 0 !important;';
                document.body.classList.add('theme-dark');
            }
        })();
    </script>

    <!-- æœ€ä¼˜å…ˆçº§CSS - é˜²æ­¢ä»»ä½•ç™½å± -->
    <style>
        /* ä½¿ç”¨CSSå˜é‡å’Œå¤šé‡ä¿é™© */
        :root {
            --bg-color: #000000;
            --text-color: #e0e0e0;
        }

        /* æœ€é«˜ä¼˜å…ˆçº§å¼ºåˆ¶é»‘è‰²èƒŒæ™¯ */
        html {
            background: #000000 !important;
            background-color: #000000 !important;
        }

        body {
            background: #000000 !important;
            background-color: #000000 !important;
            color: #e0e0e0 !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        #pwa-black-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000000 !important;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0s linear;
            z-index: 2147483647;
        }

        #pwa-black-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* è¦†ç›–æ‰€æœ‰å¯èƒ½çš„ç™½è‰²å®¹å™¨ */
        #app, .header, .content-type-selector, .editor-container {
            background: #000000 !important;
            background-color: #000000 !important;
        }

        /* å¼ºåˆ¶æ‰€æœ‰divä¸ºé»‘è‰²æˆ–é€æ˜ */
        div {
            background-color: transparent;
        }

        /* é˜²æ­¢Element UIç™½è‰²ç»„ä»¶ */
        .el-button, .el-input, .el-dialog, .el-message-box, .el-loading-mask {
            background-color: transparent !important;
        }

        /* Vditorç¼–è¾‘å™¨å¼ºåˆ¶é»‘è‰² */
        .vditor, .vditor-content, .vditor-toolbar, .vditor-wysiwyg,
        .vditor-ir, .vditor-sv, .vditor-preview {
            background: #000000 !important;
            background-color: #000000 !important;
            color: #e0e0e0 !important;
        }

        /* ç¡®ä¿PWAæ¢å¤æ—¶ä¸ä¼šç™½å± */
        body:not(.theme-dark) {
            background: #000000 !important;
            color: #e0e0e0 !important;
        }
    </style>

    <title>BlogWriter - GitHub Auto Deploy</title>
    <meta name="version" content="1.2">

    <!-- ç§»åŠ¨è®¾å¤‡çŠ¶æ€æ æ ·å¼ -->
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-navbutton-color" content="#000000">

    <link rel="icon" type="image/png" href="./img/icons/write.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./img/icons/apple-touch-icon.png">

    <!-- iOS å¯åŠ¨ç”»é¢ - çœŸå®é»‘è‰²å›¾ç‰‡æ–‡ä»¶ï¼Œè¦†ç›–æ‰€æœ‰å¸¸è§è®¾å¤‡å°ºå¯¸ -->
    <!-- iPhone X, XS, 11 Pro (1125x2436) -->
    <link rel="apple-touch-startup-image"
          media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
          href="./img/icons/apple-launch-iPhoneX-portrait.png">
    <link rel="apple-touch-startup-image"
          media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
          href="./img/icons/apple-launch-iPhoneX-landscape.png">

    <!-- iPhone XR, 11 (828x1792) -->
    <link rel="apple-touch-startup-image"
          media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
          href="./img/icons/apple-launch-iPhoneXR-portrait.png">
    <link rel="apple-touch-startup-image"
          media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
          href="./img/icons/apple-launch-iPhoneXR-landscape.png">

    <!-- iPhone XS Max, 11 Pro Max (1242x2688) -->
    <link rel="apple-touch-startup-image"
          media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
          href="./img/icons/apple-launch-iPhoneXSMax-portrait.png">
    <link rel="apple-touch-startup-image"
          media="(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
          href="./img/icons/apple-launch-iPhoneXSMax-landscape.png">

    <!-- iPhone 12, 12 Pro, 13, 13 Pro, 14, 15 (1170x2532) -->
    <link rel="apple-touch-startup-image"
          media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
          href="./img/icons/apple-launch-iPhone12-portrait.png">
    <link rel="apple-touch-startup-image"
          media="(device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
          href="./img/icons/apple-launch-iPhone12-landscape.png">

    <!-- iPhone 12 Pro Max, 13 Pro Max, 14 Plus (1284x2778) -->
    <link rel="apple-touch-startup-image"
          media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
          href="./img/icons/apple-launch-iPhone12Max-portrait.png">
    <link rel="apple-touch-startup-image"
          media="(device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
          href="./img/icons/apple-launch-iPhone12Max-landscape.png">

    <!-- iPhone 12 mini, 13 mini (1080x2340) -->
    <link rel="apple-touch-startup-image"
          media="(device-width: 360px) and (device-height: 780px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
          href="./img/icons/apple-launch-iPhone12Mini-portrait.png">
    <link rel="apple-touch-startup-image"
          media="(device-width: 360px) and (device-height: 780px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
          href="./img/icons/apple-launch-iPhone12Mini-landscape.png">

    <!-- iPhone 14 Pro, 15 Pro (1179x2556) -->
    <link rel="apple-touch-startup-image"
          media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
          href="./img/icons/apple-launch-iPhone14Pro-portrait.png">
    <link rel="apple-touch-startup-image"
          media="(device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
          href="./img/icons/apple-launch-iPhone14Pro-landscape.png">

    <!-- iPhone 14 Pro Max, 15 Pro Max (1290x2796) -->
    <link rel="apple-touch-startup-image"
          media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
          href="./img/icons/apple-launch-iPhone14ProMax-portrait.png">
    <link rel="apple-touch-startup-image"
          media="(device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
          href="./img/icons/apple-launch-iPhone14ProMax-landscape.png">

    <link rel="manifest" href="./site.webmanifest">
    <script src="https://unpkg.com/vue@2.6.14/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui@2.15.13/lib/index.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui@2.15.13/lib/theme-chalk/index.css">
    <script src="https://cdn.jsdelivr.net/npm/vditor@3.9.4/dist/index.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vditor@3.9.4/dist/index.css">

    <!-- å¼ºåˆ¶è¦†ç›–å¤–éƒ¨CSSçš„ç™½è‰²èƒŒæ™¯ -->
    <style>
        /* ç¡®ä¿è¦†ç›–Element UIå’ŒVditorçš„é»˜è®¤æ ·å¼ */
        html, body, #app {
            background-color: #000000 !important;
            background: #000000 !important;
        }

        /* è¦†ç›–å¯èƒ½çš„ç™½è‰²å®¹å™¨ */
        .vditor-content, .vditor-ir, .vditor-sv, .vditor-wysiwyg {
            background-color: transparent !important;
        }

        /* ç¡®ä¿Element UIç»„ä»¶ä¸æ˜¾ç¤ºç™½è‰² */
        .el-button:not(.el-button--primary), .el-input__inner {
            background-color: rgba(255, 255, 255, 0.1) !important;
        }
    </style>

    <script src="github-service.js"></script>
    <script src="image-service.js"></script>
    <style>
        :root {
            --vh: 1vh;
        }

        html {
            background: #000000;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000000;
            color: #e0e0e0;
        }

        /* ä¸»é¢˜ç³»ç»Ÿ */

        /* æš—å¤œæ¨¡å¼æ ·å¼ */
        .theme-dark {
            background: #000000 !important;
            color: #e0e0e0;
        }

        .theme-dark .header {
            background: #000000 !important;
            border-bottom-color: #888;
        }

        .theme-dark .content-type-selector {
            background: #000000;
        }

        /* ä¸»è¦æŒ‰é’®æ ·å¼ */
        .theme-dark .content-type-selector .el-button--primary,
        .theme-dark .el-button--primary {
            background: #002FA7 !important;
            border-color: #002FA7 !important;
            color: white !important;
        }

        .theme-dark .content-type-selector .el-button--primary:hover,
        .theme-dark .el-button--primary:hover {
            background: #0033B8 !important;
            border-color: #0033B8 !important;
            color: white !important;
        }

        /* å¼ºåˆ¶è¦†ç›–Element UIçš„é»˜è®¤æ ·å¼ */
        .theme-dark .content-type-selector .el-button.el-button--primary {
            background-color: #002FA7 !important;
            border-color: #002FA7 !important;
        }

        .theme-dark .content-type-selector .el-button.el-button--primary:hover {
            background-color: #0033B8 !important;
            border-color: #0033B8 !important;
        }

        /* å‘å¸ƒæŒ‰é’®æ ·å¼ */
        .publish-button {
            background: #9ca3af !important;
            border: none !important;
            color: #111827 !important;
            font-weight: 600 !important;
            padding: 9px 24px !important;
            border-radius: 999px !important;
            box-shadow: none !important;
            transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease !important;
            position: relative;
            top: -8px;
        }

        .publish-button.has-content {
            background: #ffffff !important;
        }

        .publish-button.has-content:hover:not(:disabled) {
            background: #f8fafc !important;
            transform: translateY(-1px) !important;
        }

        .publish-button:disabled {
            background: #9ca3af !important;
            color: #111827 !important;
            box-shadow: none !important;
            transform: none !important;
            cursor: not-allowed !important;
        }

        .publish-button.has-content:disabled {
            background: #ffffff !important;
        }

        .publish-button:focus {
            outline: none !important;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3) !important;
        }

        /* å‘å¸ƒæŒ‰é’®æˆåŠŸåŠ¨ç”» */
        .publish-button.success {
            background: #22c55e !important;
            color: #111827 !important;
            animation: successPulse 0.6s ease-out;
        }

        @keyframes successPulse {
            0% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 4px 16px rgba(76, 175, 80, 0.6);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
            }
        }

        /* GitHubé…ç½®æŒ‰é’® */
        .github-config-button {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            background: rgba(255,255,255,0.15);
            color: white;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .github-config-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
            background: rgba(255,255,255,0.25);
        }

        .github-config-button i {
            font-size: 18px;
        }

        /* è‡ªå®šä¹‰å›¾æ ‡æ ·å¼ */
        .github-config-button img {
            width: 16px;
            height: 16px;
            transition: all 0.3s ease;
            /* å°†é»‘è‰²çº¿æ¡è½¬æ¢ä¸ºç™½è‰² */
            filter: invert(1) brightness(0.9);
        }

        .github-config-button:hover img {
            filter: invert(1) brightness(1.1) drop-shadow(0 0 3px rgba(255,255,255,0.3));
            transform: scale(1.05);
        }

        /* Vditor YAML frontmatter é¢„è§ˆæ ·å¼ */
        .vditor-preview .language-yaml,
        .vditor-preview pre[data-lang="yaml"],
        .vditor-preview code.language-yaml {
            background: #002FA7 !important;
            color: white !important;
            border: 1px solid #0033B8 !important;
        }

        /* Vditor ç¼–è¾‘å™¨ä¸­çš„ YAML ä»£ç å—æ ·å¼ */
        .vditor-ir pre.vditor-ir__marker--pre code,
        .vditor-wysiwyg pre code {
            background: #002FA7 !important;
            color: white !important;
        }

        .vditor-ir .vditor-ir__main,
        .vditor-wysiwyg .vditor-wysiwyg__main,
        .vditor-sv .vditor-sv__main,
        .vditor-preview {
            font-size: 17px;
            line-height: 1.75;
        }

        /* é’ˆå¯¹ frontmatter çš„ç‰¹æ®Šæ ·å¼ */
        .vditor-preview hr + pre,
        .vditor-preview hr + pre code {
            background: #002FA7 !important;
            color: white !important;
            border: 2px solid #0033B8 !important;
            border-radius: 6px !important;
        }

        /* æ›´å¼ºåˆ¶çš„æ ·å¼è¦†ç›– - é’ˆå¯¹æ‰€æœ‰å¯èƒ½çš„YAMLæ˜¾ç¤º */
        .vditor-preview pre,
        .vditor-preview pre code,
        .vditor-preview .hljs,
        .vditor-preview .hljs-attr,
        .vditor-preview .hljs-string,
        .vditor-preview .hljs-literal {
            background: #002FA7 !important;
            color: white !important;
        }

        /* ç¡®ä¿YAMLè¯­æ³•é«˜äº®ä¹Ÿä½¿ç”¨å…‹è±å› è“ */
        .vditor-preview .hljs-attr {
            color: #FFD700 !important; /* é‡‘è‰²ç”¨äºå±æ€§å */
        }

        .vditor-preview .hljs-string {
            color: #90EE90 !important; /* æµ…ç»¿è‰²ç”¨äºå­—ç¬¦ä¸²å€¼ */
        }

        .vditor-preview .hljs-literal {
            color: #FFA500 !important; /* æ©™è‰²ç”¨äºå­—é¢é‡ */
        }

        /* ç¼–è¾‘å™¨å®¹å™¨ä¸»é¢˜æ ·å¼ */
        .theme-dark .editor-container {
            background: #000000 !important;
            border-color: #333333 !important;
            box-shadow: 0 4px 20px rgba(255,255,255,0.05);
        }
        .theme-dark #vditor,
        .theme-dark .vditor {
            background: #000000 !important;
        }


        .header {
            border-bottom: none;
            padding: 20px 28px;
            box-shadow: 0 6px 30px rgba(0,0,0,0.15);
            color: white;
            /* é»˜è®¤æ¸å˜èƒŒæ™¯ï¼Œä¼šè¢«ä¸»é¢˜æ ·å¼è¦†ç›– */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .content-type-selector {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .type-buttons {
            display: flex;
            gap: 14px;
            align-items: center;
        }
        .action-buttons {
            display: flex;
            gap: 14px;
            align-items: flex-end;
            margin-left: auto;
        }

        .action-buttons .publish-button {
            margin-left: auto;
        }

        /* ç¾åŒ–æŒ‰é’®æ ·å¼ - ç°ä»£åŒ–æŒ‰é’® */
        .el-button {
            border-radius: 12px !important;
            font-weight: 600 !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            padding: 12px 24px !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
            backdrop-filter: blur(10px) !important;
        }

        .el-button:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 16px rgba(0,0,0,0.15) !important;
        }

        .el-button:active {
            transform: translateY(0) !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
        }

        .el-button:hover {
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
        }

        .el-button.is-circle {
            border-radius: 50% !important;
            width: 40px !important;
            height: 40px !important;
            padding: 0 !important;
        }
        .editor-container {
            display: flex;
            flex-direction: column;
            height: calc(var(--vh, 1vh) * 100 - 130px);
            padding: 0;
            background: #000000;
            color: #e0e0e0;
            margin: 24px auto;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            max-width: 1200px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .editor-container:hover {
            box-shadow: 0 12px 40px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .editor-container.keyboard-open {
            height: auto !important;
            min-height: calc(var(--vh, 1vh) * 100 - 70px);
            overflow: visible;
        }

        .editor-container.keyboard-open #vditor,
        .editor-container.keyboard-open .vditor {
            height: auto !important;
        }
        .metadata-editor {
            display: flex;
            gap: 15px;
            padding: 10px 15px;
            border-bottom: 1px solid #30363d;
            position: sticky;
            top: 41px; /* Vditor toolbar height */
            z-index: 2;
        }

        /* å…ƒæ•°æ®ç¼–è¾‘å™¨ä¸»é¢˜æ ·å¼ */
        .theme-dark .metadata-editor {
            background-color: #000000;
            border-bottom-color: #30363d;
        }


        .metadata-editor .el-input {
            flex: 1;
        }
        .metadata-editor .el-input[placeholder="æ–‡ç« æ ‡é¢˜"] {
            flex: 2; /* æ ‡é¢˜æ¡†æ›´å®½ */
        }
        .metadata-editor .el-input__inner {
            height: 32px;
            line-height: 32px;
        }
        /* è¾“å…¥æ¡†ä¸»é¢˜æ ·å¼ */
        .theme-dark .el-input__inner {
            background-color: #1a1a1a !important;
            border-color: #555 !important;
            color: #e0e0e0 !important;
        }
        .theme-dark .el-input__inner:hover,
        .theme-dark .el-input__inner:focus {
            border-color: #002FA7 !important;
        }


        #vditor,
        #vditor .vditor {
            height: 100%;
            flex: 1 1 auto;
            min-height: 0;
            border-radius: 0;
            border: none !important;
            background: #000000;
            color: #e0e0e0;
        }

        /* ç¼–è¾‘å™¨å†…å®¹åŒºåŸŸå†…è¾¹è· */
        .vditor-ir .vditor-ir__main,
        .vditor-wysiwyg .vditor-wysiwyg__main,
        .vditor-sv .vditor-sv__main {
            padding: 30px 60px !important;
            max-width: none !important;
        }

        .vditor-preview {
            padding: 30px 60px !important;
            max-width: none !important;
        }

        /* ç¼–è¾‘å™¨æ–‡æœ¬åŒºåŸŸ */
        .vditor-ir .vditor-ir__main textarea {
            padding: 0 !important;
            margin: 0 !important;
        }

        /* ç¼–è¾‘å™¨å­—ä½“å¤§å° */
        .vditor-sv .vditor-sv__main textarea,
        .vditor-wysiwyg .vditor-wysiwyg__main {
            font-size: 15px !important;
            line-height: 1.6 !important;
        }

        /* Vditorç¼–è¾‘å™¨ä¸»é¢˜æ ·å¼ */

        /* æš—å¤œä¸»é¢˜ */
        .theme-dark .vditor-toolbar {
            background: #000000 !important;
            border-bottom-color: #888 !important;
        }

        .theme-dark .vditor-content,
        .theme-dark .vditor-wysiwyg,
        .theme-dark .vditor-wysiwyg .vditor-wysiwyg__main {
            background: #000000 !important;
            color: #e0e0e0 !important;
        }


        /* è¯¦ç»†çš„ç¼–è¾‘å™¨æ¨¡å¼æ ·å¼ */

        /* æš—å¤œä¸»é¢˜ - è¯¦ç»†æ ·å¼ */
        .theme-dark .vditor-wysiwyg__main,
        .theme-dark .vditor-wysiwyg__main .vditor-wysiwyg__main,
        .theme-dark .vditor-wysiwyg .vditor-wysiwyg__main .vditor-wysiwyg__main,
        .theme-dark .vditor-wysiwyg__main > div,
        .theme-dark .vditor-wysiwyg__main .vditor-wysiwyg__main > div,
        .theme-dark .vditor-wysiwyg__main[contenteditable="true"],
        .theme-dark .vditor-ir,
        .theme-dark .vditor-ir .vditor-ir__main,
        .theme-dark .vditor-ir .vditor-ir__main textarea {
            background: #000000 !important;
            background-color: #000000 !important;
            color: #e0e0e0 !important;
        }


        /* é¢„è§ˆåŒºåŸŸå’Œåˆ†å±æ¨¡å¼æ ·å¼ */

        /* æš—å¤œä¸»é¢˜ - é¢„è§ˆå’Œåˆ†å± */
        .theme-dark .vditor-preview,
        .theme-dark .vditor-preview .vditor-reset,
        .theme-dark .vditor-sv,
        .theme-dark .vditor-sv .vditor-sv__main,
        .theme-dark .vditor-sv .vditor-sv__preview,
        .theme-dark .vditor-sv .vditor-sv__preview .vditor-reset {
            background: #000000 !important;
            color: #e0e0e0 !important;
        }


        /* å¼ºåˆ¶è¦†ç›–æ‰€æœ‰å¯èƒ½çš„VditorèƒŒæ™¯æ ·å¼ */
        .theme-dark .vditor-wysiwyg *,
        .theme-dark .vditor-ir * {
            background-color: transparent !important;
        }


        /* éšè—é¢„è§ˆå·¥å…·æ çš„Desktop/Tablet/Mobileç­‰é€‰é¡¹ */
        .vditor-preview__action,
        .vditor-preview__action--current,
        .vditor-preview__action[data-type="desktop"],
        .vditor-preview__action[data-type="tablet"],
        .vditor-preview__action[data-type="mobile"],
        .vditor-preview__action[data-type="mp-wechat"],
        .vditor-preview__action[data-type="zhihu"] {
            display: none !important;
        }

        /* éšè—æ•´ä¸ªé¢„è§ˆå·¥å…·æ  */
        .vditor-preview__toolbar {
            display: none !important;
        }

        /* ç¾åŒ–GitHubé…ç½®å¼¹çª— */
        .el-dialog, .el-dialog__wrapper {
            background: transparent !important;
        }

        .github-config-dialog .el-dialog {
            background: #161b22 !important;
            border-radius: 24px !important;
            border: 1px solid #30363d !important;
            box-shadow: 0 8px 24px rgba(0,0,0,0.5) !important;
            overflow: hidden;
        }

        .github-config-dialog .el-dialog__header {
            background: #161b22 !important;
            color: #c9d1d9 !important;
            border-bottom: 1px solid #30363d !important;
            border-top-left-radius: 24px;
            border-top-right-radius: 24px;
        }

        .github-config-dialog .el-dialog__title {
            font-size: 18px !important;
            font-weight: 600;
            color: #e0e0e0 !important;
        }

        .github-config-dialog .el-dialog__body {
            background: #0d1117 !important;
            color: #c9d1d9 !important;
            padding: 25px 30px !important;
        }

        .github-config-dialog .el-form-item__label {
            color: #c9d1d9 !important;
            white-space: nowrap;
        }

        .github-config-dialog .el-input__inner {
            background: #010409 !important;
            border: 1px solid #30363d !important;
            color: #c9d1d9 !important;
            border-radius: 20px !important;
        }

        .github-config-dialog .el-input__inner:focus {
            border-color: #002FA7 !important;
            box-shadow: 0 0 0 3px rgba(0, 47, 167, 0.3) !important;
        }

        .github-config-dialog .token-instructions {
            font-size: 12px;
            color: #8b949e;
            margin-top: 8px;
            line-height: 1.6;
            background: #161b22;
            padding: 10px;
            border-radius: 6px;
        }

        .github-config-dialog .el-dialog__footer {
            background: #161b22 !important;
            border-top: 1px solid #30363d !important;
            padding: 15px 30px !important;
            border-bottom-left-radius: 24px;
            border-bottom-right-radius: 24px;
        }

        .github-config-dialog .test-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            font-weight: 500;
        }

        .github-config-dialog .test-result.success {
            background-color: rgba(34, 139, 34, 0.2);
            color: #3fb950;
            border: 1px solid rgba(34, 139, 34, 0.5);
        }

        .github-config-dialog .test-result.error {
            background-color: rgba(210, 4, 45, 0.2);
            color: #f85149;
            border: 1px solid rgba(210, 4, 45, 0.5);
        }

        .github-config-dialog .dialog-footer.is-mobile {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .github-config-dialog .dialog-footer.is-mobile .el-button {
            width: 100%;
            margin-left: 0 !important;
        }

        .github-config-dialog .dialog-footer.is-mobile .el-button + .el-button {
            margin-left: 0 !important;
        }

        @media (max-width: 600px) {
            .github-config-dialog .el-dialog__body {
                padding: 20px 18px !important;
            }

            .github-config-dialog .el-form-item__label {
                white-space: normal;
                line-height: 1.4;
                padding-bottom: 4px;
            }

            .github-config-dialog .token-instructions {
                font-size: 11px;
                line-height: 1.4;
            }

            .github-config-dialog .el-form-item {
                margin-bottom: 16px;
            }

            .github-config-dialog .el-dialog__footer {
                padding: 15px 18px !important;
            }
        }

        .metadata-info {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            margin-left: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 8px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        /* å…ƒæ•°æ®ä¿¡æ¯æ ·å¼ */
        .theme-dark .metadata-info {
            color: rgba(224, 224, 224, 0.8);
            background: rgba(255, 255, 255, 0.1);
        }


        /* ä¿å­˜æŒ‰é’®å…‹è±å› è“æ ·å¼ - æ›´å¼ºåˆ¶çš„é€‰æ‹©å™¨ */
        .save-button,
        .el-dialog .save-button,
        .el-dialog__footer .save-button,
        .el-dialog .el-button.save-button,
        .el-dialog__footer .el-button.save-button,
        button.save-button,
        .el-button--primary.save-button {
            background: #002FA7 !important;
            background-color: #002FA7 !important;
            border-color: #002FA7 !important;
            color: white !important;
            box-shadow: none !important;
        }

        .save-button:hover,
        .el-dialog .save-button:hover,
        .el-dialog__footer .save-button:hover,
        .el-dialog .el-button.save-button:hover,
        .el-dialog__footer .el-button.save-button:hover,
        button.save-button:hover,
        .el-button--primary.save-button:hover {
            background: #0033B8 !important;
            background-color: #0033B8 !important;
            border-color: #0033B8 !important;
            color: white !important;
            box-shadow: none !important;
        }

        .save-button:focus,
        .save-button:active,
        .el-dialog .save-button:focus,
        .el-dialog .save-button:active,
        .el-dialog__footer .save-button:focus,
        .el-dialog__footer .save-button:active,
        .el-dialog .el-button.save-button:focus,
        .el-dialog .el-button.save-button:active,
        .el-dialog__footer .el-button.save-button:focus,
        .el-dialog__footer .el-button.save-button:active,
        button.save-button:focus,
        button.save-button:active,
        .el-button--primary.save-button:focus,
        .el-button--primary.save-button:active {
            background: #002FA7 !important;
            background-color: #002FA7 !important;
            border-color: #002FA7 !important;
            color: white !important;
            box-shadow: none !important;
        }

        /* é€šç”¨æŒ‰é’®æ ·å¼ */
        .theme-dark .el-button:not(.publish-button) {
            background: #333 !important;
            border-color: #555 !important;
            color: #e0e0e0 !important;
        }

        .theme-dark .el-button:not(.publish-button):hover {
            background: #444 !important;
            border-color: #666 !important;
        }

        .theme-dark .el-button--primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            border-color: transparent !important;
        }


        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header {
                padding: 14px 20px 8px;
                background: #000000 !important; /* ç§»åŠ¨ç«¯å›ºå®šæš—é»‘æ¨¡å¼ */
            }

            .content-type-selector {
                max-width: 100%;
                gap: 16px;
            }

            .editor-container {
                margin: 16px auto;
                border-radius: 12px;
                max-width: calc(100% - 32px);
                box-shadow: 0 6px 24px rgba(0,0,0,0.1), 0 2px 6px rgba(0,0,0,0.06);
            }

            .editor-container:hover {
                transform: none; /* ç§»åŠ¨ç«¯ç¦ç”¨hoveråŠ¨ç”» */
            }

            /* ç§»åŠ¨ç«¯ç¼–è¾‘å™¨å†…è¾¹è·è°ƒæ•´ - å…¨å±ä½“éªŒ */
            .vditor-ir .vditor-ir__main,
            .vditor-wysiwyg .vditor-wysiwyg__main,
            .vditor-sv .vditor-sv__main,
            .vditor-preview {
                padding: 20px 18px !important;
                font-size: 19px !important;
                line-height: 1.75 !important;
            }

            .vditor-ir .vditor-ir__main textarea,
            .vditor-sv .vditor-sv__main textarea,
            .vditor-wysiwyg .vditor-wysiwyg__main,
            .vditor-ir .vditor-reset,
            .vditor-wysiwyg .vditor-reset,
            .vditor-preview .vditor-reset {
                font-size: 19px !important;
                line-height: 1.75 !important;
            }

            .content-type-selector {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
                gap: 12px;
            }

            .type-buttons {
                display: flex;
                gap: 10px;
                flex-shrink: 0;
            }

            .action-buttons {
                display: flex;
                gap: 10px;
                flex-shrink: 0;
                width: 100%;
                flex: 1;
                align-items: center;
            }

            .action-buttons .publish-button {
                margin-left: auto;
            }

            /* ä¼˜åŒ–ç§»åŠ¨ç«¯æŒ‰é’®æ ·å¼ */
            .type-buttons .el-button {
                padding: 11px 18px !important;
                font-size: 15px !important;
                font-weight: 500 !important;
                border-radius: 20px !important;
            }

            /* ç§»åŠ¨ç«¯éšè—æ‰€æœ‰ç±»å‹é€‰æ‹©æŒ‰é’®ï¼Œé»˜è®¤Essaysæ¨¡å¼ */
            .type-buttons {
                display: none !important;
            }

            /* ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šé‡æ–°å¸ƒå±€ï¼Œé…ç½®æŒ‰é’®åœ¨å·¦è¾¹ï¼Œå‘å¸ƒæŒ‰é’®åœ¨å³è¾¹ */
            .content-type-selector {
                justify-content: space-between !important;
                padding: 0 16px;
            }

            .action-buttons {
                order: -1; /* å°†é…ç½®æŒ‰é’®ç§»åˆ°å·¦è¾¹ */
            }

            /* ç§»åŠ¨ç«¯å…¨å±ç¼–è¾‘å™¨è®¾è®¡ */
            .editor-container {
                height: calc(var(--vh, 1vh) * 100 - 70px) !important; /* å‡å»å¤´éƒ¨é«˜åº¦ */
                margin: 0 !important;
                border-radius: 0 !important;
                border: none !important;
                box-shadow: none !important;
                max-width: 100% !important;
            }

            .editor-container:hover {
                transform: none !important;
                box-shadow: none !important;
            }

            .github-config-button {
                width: auto !important;
                height: auto !important;
                padding: 8px !important;
                background: transparent !important;
                border: none !important;
                box-shadow: none !important;
                border-radius: 0 !important;
                backdrop-filter: none !important;
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                position: relative !important;
                top: -6px !important;
            }

            .github-config-button i {
                font-size: 22px !important;
            }

            .github-config-button img {
                width: 22px !important;
                height: 22px !important;
            }

            .publish-button {
                padding: 8px 18px !important;
                font-size: 20px !important;
                border-radius: 999px !important;
                min-height: 44px !important;
                min-width: 96px !important;
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                position: relative !important;
                top: -6px !important;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 12px 16px 6px;
            }

            .content-type-selector {
                gap: 12px;
                padding: 0 8px;
            }

            /* è¶…å°å±å¹•å…¨å±ç¼–è¾‘å™¨ */
            .editor-container {
                height: calc(var(--vh, 1vh) * 100 - 60px) !important;
                margin: 0 !important;
                border-radius: 0 !important;
                border: none !important;
                box-shadow: none !important;
                max-width: 100% !important;
            }

            /* è¶…å°å±å¹•ç¼–è¾‘å™¨å†…è¾¹è·è°ƒæ•´ - æœ€å¤§åŒ–å†™ä½œç©ºé—´ */
            .vditor-ir .vditor-ir__main,
            .vditor-wysiwyg .vditor-wysiwyg__main,
            .vditor-sv .vditor-sv__main,
            .vditor-preview {
                padding: 18px 14px !important;
                font-size: 19px !important;
                line-height: 1.75 !important;
            }

            .vditor-ir .vditor-ir__main textarea,
            .vditor-sv .vditor-sv__main textarea,
            .vditor-wysiwyg .vditor-wysiwyg__main,
            .vditor-ir .vditor-reset,
            .vditor-wysiwyg .vditor-reset,
            .vditor-preview .vditor-reset {
                font-size: 19px !important;
                line-height: 1.75 !important;
            }

            /* è¶…å°å±å¹•æŒ‰é’®ä¼˜åŒ– */
            .type-buttons .el-button {
                padding: 9px 16px !important;
                font-size: 14px !important;
            }

            /* è¶…å°å±å¹•EssaysæŒ‰é’®ä¼˜åŒ– */
            .type-buttons .el-button[data-type="essay"] {
                max-width: 120px;
            }

            .publish-button {
                padding: 9px 16px !important;
                font-size: 14px !important;
            }

            .type-buttons,
            .action-buttons {
                gap: 8px;
            }
        }

        /* ç§»åŠ¨ç«¯å¼¹çª—ä¼˜åŒ– */
        @media (max-width: 768px) {
            body {
                font-size: 17px !important;
            }

            .header {
                font-size: 18px !important;
            }

            .el-dialog {
                width: 90% !important;
                max-width: 400px !important;
                margin: 0 auto !important;
                top: 15vh !important;
                transform: none !important;
            }

            .el-dialog__header {
                padding: 15px 20px 10px !important;
            }

            .el-dialog__body {
                padding: 10px 20px 20px !important;
                max-height: 60vh !important;
                overflow-y: auto !important;
            }

            .el-dialog__footer {
                padding: 10px 20px 15px !important;
            }
        }

        @media (max-width: 480px) {
            .el-dialog {
                width: 95% !important;
                max-width: 350px !important;
                top: 10vh !important;
            }

            .el-dialog__header {
                padding: 12px 15px 8px !important;
            }

            .el-dialog__body {
                padding: 8px 15px 15px !important;
                max-height: 65vh !important;
                font-size: 14px !important;
            }

            .el-dialog__footer {
                padding: 8px 15px 12px !important;
            }

            /* ç§»åŠ¨ç«¯è¡¨å•å…ƒç´ ä¼˜åŒ– */
            .el-input__inner {
                font-size: 16px !important; /* é˜²æ­¢iOSç¼©æ”¾ */
            }

            .el-button {
                padding: 8px 15px !important;
                font-size: 14px !important;
            }
        }

        /* å›¾ç‰‡æ‹–æ‹½æ ·å¼ */
        .drag-over {
            border: 2px dashed #002FA7 !important;
            background-color: rgba(0, 47, 167, 0.1) !important;
            position: relative;
        }

        .drag-over::after {
            content: 'æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„ä¸Šä¼ ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 47, 167, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            z-index: 1000;
            pointer-events: none;
        }

        /* å›¾ç‰‡ä¸Šä¼ è¿›åº¦æ ·å¼ */
        .upload-progress {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 5px;
            z-index: 2000;
            min-width: 300px;
        }

        .upload-progress .progress-item {
            margin-bottom: 10px;
        }

        .upload-progress .progress-item:last-child {
            margin-bottom: 0;
        }

        /* PWAé…ç½®å¯¹è¯æ¡†æ ·å¼ */
        .pwa-config-dialog .el-message-box {
            width: 90% !important;
            max-width: 400px !important;
        }

        .pwa-config-dialog .el-message-box__message {
            font-size: 14px !important;
            line-height: 1.6 !important;
            color: #606266 !important;
        }

        .pwa-config-dialog .el-message-box__btns {
            padding: 15px 20px 20px !important;
        }

        .pwa-config-dialog .el-button {
            font-size: 14px !important;
            padding: 8px 16px !important;
        }

        /* æ¶ˆæ¯æç¤ºæš—è‰²ä¸»é¢˜ï¼Œä¿æŒçŠ¶æ€æ ä¸èƒŒæ™¯ä¸€è‡´ */
        .el-message {
            background: rgba(17, 24, 39, 0.92) !important;
            color: #f9fafb !important;
            border: 1px solid rgba(148, 163, 184, 0.25) !important;
            box-shadow: 0 12px 30px rgba(15, 23, 42, 0.45) !important;
            backdrop-filter: blur(12px);
        }

        .el-message__icon,
        .el-message__content,
        .el-message__closeBtn {
            color: inherit !important;
        }

        .el-message--success {
            border-color: rgba(34, 197, 94, 0.35) !important;
        }

        .el-message--warning {
            border-color: rgba(234, 179, 8, 0.35) !important;
        }

        .el-message--error {
            border-color: rgba(248, 113, 113, 0.35) !important;
        }

        /* å¿«é€Ÿé…ç½®æŒ‰é’®æ ·å¼ */
        .quick-config-button {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4) !important;
            border: none !important;
            animation: quickConfigPulse 2s infinite;
        }

        .quick-config-button:hover {
            background: linear-gradient(45deg, #FF5252, #26C6DA) !important;
            transform: scale(1.05);
        }

        @keyframes quickConfigPulse {
            0%, 100% {
                box-shadow: 0 0 5px rgba(255, 107, 107, 0.5);
            }
            50% {
                box-shadow: 0 0 15px rgba(78, 205, 196, 0.7);
            }
        }




    </style>
</head>
<body class="theme-dark" style="background:#000000;color:#e0e0e0;">
    <div id="pwa-black-overlay"></div>
    <div id="app">
        <div class="header">
            <div class="content-type-selector">
                <div class="type-buttons">
                    <el-button
                        v-for="(label, type) in contentTypeLabels"
                        :key="type"
                        :type="currentType === type ? 'primary' : 'default'"
                        @click="selectType(type)"
                        size="small"
                        :data-type="type">
                        <i :class="getTypeIcon(type)"></i>
                        {{ label }}
                    </el-button>
                </div>
                <div class="action-buttons">
                    <button class="github-config-button" @click="configureGitHub" :title="isGitHubConfigured ? 'GitHubå·²é…ç½®' : 'é…ç½®GitHub'">
                        <i class="el-icon-setting"></i>
                    </button>
                    <button
                        v-if="isMobileView"
                        class="github-config-button mobile-upload-button"
                        @click="triggerMobileImageUpload"
                        title="ä¸Šä¼ å›¾ç‰‡">
                        <i class="el-icon-picture-outline"></i>
                    </button>
                    <input
                        v-if="isMobileView"
                        ref="mobileImageInput"
                        type="file"
                        accept="image/*"
                        multiple
                        style="display: none;"
                        @change="handleMobileImageChange">
                    <button v-if="isPWAMode && !isImageServiceConfigured" class="github-config-button quick-config-button" @click="showQuickConfig" title="PWAå¿«é€Ÿé…ç½®">
                        <i class="el-icon-magic-stick"></i>
                    </button>
                    <el-button
                        @click="publish"
                        size="medium"
                        :disabled="!isGitHubConfigured"
                        class="publish-button"
                        :class="{ 'has-content': hasBodyContent }">
                        å‘å¸ƒ
                    </el-button>
                </div>
            </div>
        </div>

        <div class="editor-container">
            <!-- å…ƒæ•°æ®ç¼–è¾‘å™¨å°†é€šè¿‡JSç§»åŠ¨åˆ°Vditorå·¥å…·æ ä¸‹æ–¹ -->
            <div id="metadata-editor-wrapper" style="display: none;">
                <div class="metadata-editor"
                     v-if="currentType !== 'general' && currentType !== 'gallery' && currentType !== 'essay' && hasVisibleFields">
                    <el-input v-if="metadataFields[currentType].some(f => f.key === 'title')" v-model="metadata.title" placeholder="Title" size="small"></el-input>
                    <el-input v-if="metadataFields[currentType].some(f => f.key === 'categories')" v-model="metadata.categories" placeholder="Categories (comma-separated)" size="small"></el-input>
                    <el-input v-if="metadataFields[currentType].some(f => f.key === 'description')" v-model="metadata.description" placeholder="Description" size="small"></el-input>
                    <el-date-picker v-if="metadataFields[currentType].some(f => f.key === 'date' && f.type === 'date')" v-model="metadata.date" type="date" placeholder="æ‹æ‘„æ—¥æœŸ" size="small" format="yyyy-MM-dd" value-format="yyyy-MM-dd"></el-date-picker>
                </div>
            </div>

            <div id="vditor"></div>
        </div>



        <github-config
            :visible="githubConfigVisible"
            @close="githubConfigVisible = false"
            @save="handleGitHubConfigSave">
        </github-config>

        <!-- ä¸Šä¼ è¿›åº¦æç¤º -->
        <el-dialog
            title="å›¾ç‰‡ä¸Šä¼ ä¸­"
            :visible.sync="uploadProgress.visible"
            width="400px"
            :close-on-click-modal="false"
            :close-on-press-escape="false"
            :show-close="false">
            <div style="text-align: center;">
                <p>æ­£åœ¨ä¸Šä¼ ç¬¬ {{ uploadProgress.current }} / {{ uploadProgress.total }} å¼ å›¾ç‰‡</p>
                <p>{{ uploadProgress.fileName }}</p>
                <p>{{ getStageText(uploadProgress.stage) }}</p>
                <div v-if="uploadProgress.stage === 'compressing' && uploadProgress.currentSize > 0" style="font-size: 12px; color: #666; margin: 5px 0;">
                    <p>å‹ç¼©è´¨é‡: {{ Math.round(uploadProgress.quality * 100) }}%</p>
                    <p>å½“å‰å¤§å°: {{ formatFileSize(uploadProgress.currentSize) }} / ç›®æ ‡: {{ formatFileSize(uploadProgress.targetSize) }}</p>
                </div>
                <el-progress :percentage="uploadProgress.progress" :show-text="false"></el-progress>
            </div>
        </el-dialog>

        <!-- ç§»åŠ¨ç«¯é”™è¯¯æ˜¾ç¤ºå¯¹è¯æ¡† -->
        <el-dialog
            title="é”™è¯¯è¯¦æƒ…"
            :visible.sync="mobileErrorDialog.visible"
            width="90%"
            :close-on-click-modal="false">
            <div style="font-family: monospace; font-size: 12px; white-space: pre-wrap; max-height: 400px; overflow-y: auto; background: #f5f5f5; padding: 10px; border-radius: 4px;">
                {{ mobileErrorDialog.content }}
            </div>
            <div slot="footer" class="dialog-footer">
                <el-button @click="copyErrorToClipboard">å¤åˆ¶é”™è¯¯ä¿¡æ¯</el-button>
                <el-button type="primary" @click="mobileErrorDialog.visible = false">å…³é—­</el-button>
            </div>
        </el-dialog>
    </div>

    <script>
        // ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½ååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–GitHubæœåŠ¡
            if (!window.githubService) {
                window.githubService = new GitHubService();
                window.githubService.loadConfig();
            }

        // é…ç½®å¸¸é‡
        const contentTypes = {
            GENERAL: 'general',
            BLOG: 'blog',
            ESSAY: 'essay',
            GALLERY: 'gallery'
        };

        const contentTypeLabels = {
            [contentTypes.BLOG]: 'Blogs',
            [contentTypes.ESSAY]: 'Essays',
            [contentTypes.GALLERY]: 'Gallery'
        };

        const metadataFields = {
            [contentTypes.BLOG]: [
                { key: 'title', label: 'æ ‡é¢˜', type: 'text', required: true },
                { key: 'categories', label: 'åˆ†ç±»', type: 'tags' },
                { key: 'date', label: 'å‘å¸ƒæ—¥æœŸ', type: 'datetime' }
            ],
            [contentTypes.ESSAY]: [
                { key: 'pubDate', label: 'å‘å¸ƒæ—¥æœŸ', type: 'datetime' }
            ],
            [contentTypes.GALLERY]: [
                // Galleryæ¨¡å¼ä¸æ˜¾ç¤ºä»»ä½•å…ƒæ•°æ®å­—æ®µï¼Œdateåœ¨åå°è‡ªåŠ¨æ·»åŠ 
            ]
        };

        // æ¨¡æ¿ç”Ÿæˆå‡½æ•°
        function generateContentWithMetadata(contentType, metadata, content) {
            if (contentType === contentTypes.GENERAL) {
                return content;
            }

            const frontmatter = Object.keys(metadata)
                .filter(key => metadata[key] !== undefined && metadata[key] !== '')
                .map(key => {
                    let value = metadata[key];
                    if (key === 'categories' && typeof value === 'string') {
                        value = value.split(',').map(cat => cat.trim()).filter(cat => cat);
                    }
                    if (typeof value === 'string' && value.includes(':')) {
                        value = `"${value}"`;
                    }
                    return `${key}: ${Array.isArray(value) ? JSON.stringify(value) : value}`;
                })
                .join('\n');

            return `---\n${frontmatter}\n---\n\n${content}`;
        }

        // GitHub ä¸å›¾åºŠä¸€ä½“åŒ–é…ç½®ç»„ä»¶
        Vue.component('github-config', {
            props: ['visible'],
            data() {
                return {
                    activeTab: 'github',
                    githubConfig: {
                        token: '',
                        owner: '',
                        repo: ''
                    },
                    imageConfig: {
                        token: '',
                        owner: '',
                        repo: '',
                        branch: 'main',
                        imageDir: 'images'
                    },
                    linkRules: {
                        github: 'GitHubåŸå§‹é“¾æ¥',
                        jsdelivr: 'jsDelivr CDN',
                        statically: 'Statically CDN',
                        'china-jsdelivr': 'ä¸­å›½jsDelivr CDN'
                    },
                    selectedLinkRule: 'jsdelivr',
                    githubTesting: false,
                    githubTestResult: null,
                    imageTesting: false,
                    imageTestResult: null,
                    isMobile: window.innerWidth <= 600
                };
            },
            watch: {
                visible(newVal) {
                    if (newVal) {
                        this.loadConfig();
                    }
                }
            },
            mounted() {
                this.updateResponsiveState();
                window.addEventListener('resize', this.updateResponsiveState);
            },
            beforeDestroy() {
                window.removeEventListener('resize', this.updateResponsiveState);
            },
            methods: {
                updateResponsiveState() {
                    this.isMobile = window.innerWidth <= 600;
                },
                loadConfig() {
                    const savedGithub = localStorage.getItem('github-config');
                    if (savedGithub) {
                        this.githubConfig = {
                            ...this.githubConfig,
                            ...JSON.parse(savedGithub)
                        };
                    }

                    const savedImage = localStorage.getItem('image-service-config');
                    if (savedImage) {
                        const parsed = JSON.parse(savedImage);
                        this.imageConfig = {
                            ...this.imageConfig,
                            ...parsed,
                            branch: (parsed.branch || '').trim() || 'main',
                            imageDir: (parsed.imageDir || '').trim() || 'images'
                        };
                    } else {
                        this.imageConfig = {
                            ...this.imageConfig,
                            token: this.githubConfig.token || '',
                            owner: this.githubConfig.owner || '',
                            repo: this.githubConfig.repo || ''
                        };
                    }

                    const savedRule = localStorage.getItem('image-service-link-rule');
                    if (window.imageService && typeof window.imageService.getLinkRule === 'function') {
                        const rule = window.imageService.getLinkRule();
                        if (rule) {
                            this.selectedLinkRule = this.resolveRuleKey(rule) || 'jsdelivr';
                        }
                    } else if (savedRule) {
                        this.selectedLinkRule = this.resolveRuleKey(savedRule) || 'jsdelivr';
                    }

                    this.githubTestResult = null;
                    this.imageTestResult = null;
                    this.githubTesting = false;
                    this.imageTesting = false;
                    this.activeTab = 'github';
                },
                async testGithubConnection() {
                    if (!this.githubConfig.token || !this.githubConfig.owner || !this.githubConfig.repo) {
                        this.$message.warning('è¯·å…ˆå¡«å†™å®Œæ•´çš„ GitHub é…ç½®ä¿¡æ¯');
                        this.activeTab = 'github';
                        return;
                    }

                    this.githubTesting = true;
                    this.githubTestResult = null;

                    try {
                        const tempService = new GitHubService();
                        tempService.setConfig(this.githubConfig);

                        const result = await tempService.testConnection();

                        if (result.success) {
                            this.githubTestResult = {
                                success: true,
                                message: `è¿æ¥æˆåŠŸï¼ç”¨æˆ·: ${result.user}ï¼Œä»“åº“: ${result.repo}ï¼Œæƒé™: ${result.permissions}`
                            };
                        } else {
                            this.githubTestResult = {
                                success: false,
                                message: result.error
                            };
                        }
                    } catch (error) {
                        this.githubTestResult = {
                            success: false,
                            message: `è¿æ¥å¤±è´¥: ${error.message}`
                        };
                    } finally {
                        this.githubTesting = false;
                    }
                },
                async testImageConnection() {
                    if (!this.imageConfig.token || !this.imageConfig.owner || !this.imageConfig.repo) {
                        this.$message.warning('è¯·å…ˆå¡«å†™å®Œæ•´çš„å›¾åºŠé…ç½®ä¿¡æ¯');
                        this.activeTab = 'image';
                        return;
                    }

                    this.imageTesting = true;
                    this.imageTestResult = null;

                    try {
                        const tempService = new ImageService();
                        tempService.setConfig(this.imageConfig);

                        const result = await tempService.testConnection();

                        if (result.success) {
                            this.imageTestResult = {
                                success: true,
                                message: `è¿æ¥æˆåŠŸï¼ç”¨æˆ·: ${result.user}ï¼Œä»“åº“: ${result.repo}ï¼Œæƒé™: ${result.permissions}`
                            };
                        } else {
                            this.imageTestResult = {
                                success: false,
                                message: result.error
                            };
                        }
                    } catch (error) {
                        this.imageTestResult = {
                            success: false,
                            message: `è¿æ¥å¤±è´¥: ${error.message}`
                        };
                    } finally {
                        this.imageTesting = false;
                    }
                },
                resolveRuleKey(value) {
                    if (value === undefined || value === null) {
                        return null;
                    }
                    if (this.linkRules[value]) {
                        return value;
                    }
                    const normalized = this.normalizeRuleKey(value);
                    return Object.keys(this.linkRules).find(key => this.normalizeRuleKey(key) === normalized) || null;
                },
                normalizeRuleKey(value) {
                    return String(value || '')
                        .trim()
                        .toLowerCase()
                        .replace(/[^a-z0-9]/g, '');
                },
                save() {
                    if (!this.githubConfig.token || !this.githubConfig.owner || !this.githubConfig.repo) {
                        this.$message.warning('è¯·å…ˆå¡«å†™å®Œæ•´çš„ GitHub é…ç½®ä¿¡æ¯');
                        this.activeTab = 'github';
                        return;
                    }

                    if (!this.imageConfig.token || !this.imageConfig.owner || !this.imageConfig.repo) {
                        this.$message.warning('è¯·å…ˆå¡«å†™å®Œæ•´çš„å›¾åºŠé…ç½®ä¿¡æ¯');
                        this.activeTab = 'image';
                        return;
                    }

                    const normalizedImageConfig = {
                        ...this.imageConfig,
                        branch: (this.imageConfig.branch || '').trim() || 'main',
                        imageDir: (this.imageConfig.imageDir || '').trim() || 'images'
                    };
                    const matchedRule = this.resolveRuleKey(this.selectedLinkRule) || 'jsdelivr';

                    localStorage.setItem('github-config', JSON.stringify(this.githubConfig));
                    localStorage.setItem('image-service-config', JSON.stringify(normalizedImageConfig));
                    localStorage.setItem('image-service-link-rule', matchedRule);

                    if (window.imageService) {
                        window.imageService.setConfig(normalizedImageConfig);
                        if (typeof window.imageService.setLinkRule === 'function') {
                            window.imageService.setLinkRule(matchedRule);
                        }
                    }

                    this.$emit('save', {
                        github: { ...this.githubConfig },
                        image: normalizedImageConfig,
                        linkRule: matchedRule
                    });
                    this.close();
                },
                close() {
                    this.$emit('close');
                }
            },
            template: `
                <el-dialog
                    title="ä»“åº“ä¸å›¾åºŠé…ç½®"
                    :visible.sync="visible"
                    :width="isMobile ? '96vw' : '640px'"
                    @close="close"
                    custom-class="github-config-dialog">
                    <el-tabs v-model="activeTab" type="card">
                        <el-tab-pane label="GitHub ä»“åº“" name="github">
                            <el-form
                                :model="githubConfig"
                                :label-width="isMobile ? 'auto' : '140px'"
                                :label-position="isMobile ? 'top' : 'left'">
                                <el-form-item label="Personal Token">
                                    <el-input
                                        v-model="githubConfig.token"
                                        type="password"
                                        placeholder="Enter your GitHub Personal Access Token"
                                        show-password>
                                    </el-input>
                                    <div class="token-instructions">
                                        <strong>How to get a token:</strong><br>
                                        1. GitHub â†’ Settings â†’ Developer settings<br>
                                        2. Personal access tokens â†’ Tokens (classic)<br>
                                        3. Generate new token (classic)<br>
                                        4. Check the <strong>repo</strong> scope â†’ Generate token<br>
                                        5. Copy the token and paste it here.
                                    </div>
                                </el-form-item>

                                <el-form-item label="Repository Owner">
                                    <el-input
                                        v-model="githubConfig.owner"
                                        placeholder="Your GitHub username or organization">
                                    </el-input>
                                </el-form-item>

                                <el-form-item label="Repository Name">
                                    <el-input
                                        v-model="githubConfig.repo"
                                        placeholder="The name of the repository">
                                    </el-input>
                                </el-form-item>
                            </el-form>

                            <div v-if="githubTestResult" :class="['test-result', githubTestResult.success ? 'success' : 'error']">
                                {{ githubTestResult.message }}
                            </div>
                        </el-tab-pane>

                        <el-tab-pane label="å›¾åºŠè®¾ç½®" name="image">
                            <el-form
                                :model="imageConfig"
                                :label-width="isMobile ? 'auto' : '140px'"
                                :label-position="isMobile ? 'top' : 'left'">
                                <el-form-item label="Personal Token">
                                    <el-input
                                        v-model="imageConfig.token"
                                        type="password"
                                        placeholder="è¯·è¾“å…¥ç”¨äºå›¾åºŠçš„ GitHub Token"
                                        show-password>
                                    </el-input>
                                </el-form-item>

                                <el-form-item label="Repository Owner">
                                    <el-input
                                        v-model="imageConfig.owner"
                                        placeholder="GitHub ç”¨æˆ·åæˆ–ç»„ç»‡å">
                                    </el-input>
                                </el-form-item>

                                <el-form-item label="Repository Name">
                                    <el-input
                                        v-model="imageConfig.repo"
                                        placeholder="å­˜æ”¾å›¾ç‰‡çš„ä»“åº“å">
                                    </el-input>
                                </el-form-item>

                                <el-form-item label="Branch">
                                    <el-input
                                        v-model="imageConfig.branch"
                                        placeholder="åˆ†æ”¯åç§°ï¼Œå¦‚ main æˆ– master">
                                    </el-input>
                                </el-form-item>

                                <el-form-item label="å›¾ç‰‡ç›®å½•">
                                    <el-input
                                        v-model="imageConfig.imageDir"
                                        placeholder="å›¾ç‰‡ä¿å­˜ç›®å½•ï¼Œå¦‚ images æˆ– uploads">
                                    </el-input>
                                </el-form-item>

                                <el-form-item label="é“¾æ¥ç”Ÿæˆè§„åˆ™">
                                    <el-select v-model="selectedLinkRule" placeholder="è¯·é€‰æ‹©">
                                        <el-option
                                            v-for="(label, value) in linkRules"
                                            :key="value"
                                            :label="label"
                                            :value="value">
                                        </el-option>
                                    </el-select>
                                </el-form-item>
                            </el-form>

                            <div v-if="imageTestResult" :class="['test-result', imageTestResult.success ? 'success' : 'error']">
                                {{ imageTestResult.message }}
                            </div>
                        </el-tab-pane>
                    </el-tabs>

                    <div slot="footer" :class="['dialog-footer', { 'is-mobile': isMobile }]">
                        <el-button @click="testGithubConnection" :loading="githubTesting">æµ‹è¯• GitHub</el-button>
                        <el-button @click="testImageConnection" :loading="imageTesting">æµ‹è¯•å›¾åºŠ</el-button>
                        <el-button @click="close">å–æ¶ˆ</el-button>
                        <el-button type="primary" @click="save" class="save-button">ä¿å­˜é…ç½®</el-button>
                    </div>
                </el-dialog>
            `
        });
        // ä¸»Vueå®ä¾‹
        new Vue({
            el: '#app',
            data() {
                return {
                    vditor: null,
                    currentType: contentTypes.ESSAY, // é»˜è®¤ä¸ºEssaysæ¨¡å¼
                    metadata: {},
                    githubConfigVisible: false,
                    contentTypeLabels,
                    isGitHubConfigured: false,
                    isMobileView: false,
                    metadataFields,
                    bodyContent: '',
                    hasUserInteracted: false,
                    // å›¾ç‰‡ä¸Šä¼ ç›¸å…³
                    isImageServiceConfigured: false,
                    uploadingImages: false,
                    uploadProgress: {
                        visible: false,
                        current: 0,
                        total: 0,
                        fileName: '',
                        stage: '',
                        progress: 0,
                        currentSize: 0,
                        targetSize: 0,
                        quality: 0
                    },
                    // ç§»åŠ¨ç«¯é”™è¯¯æ˜¾ç¤º
                    mobileErrorDialog: {
                        visible: false,
                        content: ''
                    },
                    // PWAæ¨¡å¼æ£€æµ‹
                    isPWAMode: false,
                    // Galleryæ¨¡å¼ç›¸å…³
                    galleryPreview: {
                        url: null,
                        fileName: '',
                        size: 0,
                        file: null
                    },
                    editingFile: null
                };
            },

            computed: {
                hasVisibleFields() {
                    if (!this.currentType || this.currentType === 'general' || this.currentType === 'gallery') {
                        return false;
                    }
                    const fields = this.metadataFields[this.currentType];
                    return fields && fields.length > 0;
                },

                hasBodyContent() {
                    return !!(this.bodyContent && this.bodyContent.trim().length);
                }
            },

            mounted() {
                this.isMobileView = this.isMobileDevice();
                this.initTheme();
                this.setupMobileDefaults();
                this.setupViewportFixes();
                this.initVditor();
                this.selectType(this.currentType);
                this.checkGitHubConfig();
                this.checkImageServiceConfig();
                this.checkForEditFile();
                this.detectPWAMode();
                this.checkPWAConfigMissing();

                // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–ï¼Œé˜²æ­¢PWAæ¢å¤æ—¶ç™½å±
                this.setupVisibilityHandler();
            },

            beforeDestroy() {
                // æ¸…ç†ç›‘å¬å™¨
                if (this.visibilityHandler) {
                    document.removeEventListener('visibilitychange', this.visibilityHandler);
                    this.visibilityHandler = null;
                }
                if (this.pageShowHandler) {
                    window.removeEventListener('pageshow', this.pageShowHandler);
                    this.pageShowHandler = null;
                }
                if (this.pageHideHandler) {
                    window.removeEventListener('pagehide', this.pageHideHandler);
                    this.pageHideHandler = null;
                }
            },

            methods: {
                // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
                isMobileDevice() {
                    const userAgent = navigator.userAgent.toLowerCase();
                    const mobileKeywords = ['mobile', 'android', 'iphone', 'ipad', 'ipod', 'blackberry', 'windows phone'];
                    return mobileKeywords.some(keyword => userAgent.includes(keyword)) ||
                           window.innerWidth <= 768;
                },

                // ä¸ºç§»åŠ¨è®¾å¤‡è®¾ç½®é»˜è®¤é…ç½®
                setupMobileDefaults() {
                    if (this.isMobileDevice()) {
                        // è®¾ç½®ä¸ºEssaysæ¨¡å¼
                        this.currentType = contentTypes.ESSAY;
                    }
                },

                setupViewportFixes() {
                    const updateViewportUnit = () => {
                        const vh = window.innerHeight * 0.01;
                        document.documentElement.style.setProperty('--vh', `${vh}px`);
                        this.isMobileView = this.isMobileDevice();
                    };

                    let lastViewportHeight = window.innerHeight;
                    updateViewportUnit();

                    const handleResize = () => {
                        const currentHeight = window.innerHeight;
                        const heightDrop = lastViewportHeight - currentHeight;

                        if (this.isMobileDevice() && heightDrop > 150) {
                            // é”®ç›˜å¼¹å‡ºæ—¶å¿½ç•¥viewporté«˜åº¦å˜åŒ–ï¼Œé¿å…å¸ƒå±€è·³åŠ¨
                            return;
                        }

                        lastViewportHeight = currentHeight;
                        updateViewportUnit();
                    };

                    window.addEventListener('resize', handleResize);
                    window.addEventListener('orientationchange', () => {
                        setTimeout(() => {
                            lastViewportHeight = window.innerHeight;
                            updateViewportUnit();
                        }, 300);
                    });

                    if (!this.isMobileDevice()) {
                        return;
                    }

                    const editorContainer = document.querySelector('.editor-container');
                    if (!editorContainer) {
                        return;
                    }

                    const toggleKeyboardState = (isOpen) => {
                        editorContainer.classList.toggle('keyboard-open', isOpen);
                    };

                    document.addEventListener('focusin', (event) => {
                        if (event.target.closest('#vditor')) {
                            toggleKeyboardState(true);
                        }
                    });

                    document.addEventListener('focusout', () => {
                        setTimeout(() => {
                            const active = document.activeElement;
                            if (!active || !active.closest || !active.closest('#vditor')) {
                                toggleKeyboardState(false);
                            }
                        }, 0);
                    });
                },

                triggerMobileImageUpload() {
                    if (!this.isImageServiceConfigured) {
                        this.$message.warning('è¯·å…ˆé…ç½®å›¾åºŠæœåŠ¡');
                        return;
                    }

                    if (this.uploadingImages) {
                        this.$message({ message: 'æ­£åœ¨ä¸Šä¼ å›¾ç‰‡ï¼Œè¯·ç¨å€™', type: 'info' });
                        return;
                    }

                    const input = this.$refs.mobileImageInput;
                    if (input) {
                        input.click();
                    }
                },

                async handleMobileImageChange(event) {
                    const { files } = event.target;
                    if (!files || !files.length) {
                        return;
                    }

                    try {
                        await this.handleImageUpload(files);
                    } finally {
                        event.target.value = '';
                    }
                },

                initTheme() {
                    // å¼ºåˆ¶ç¡®ä¿ä¸»é¢˜è®¾ç½®æ­£ç¡®ï¼Œç‰¹åˆ«æ˜¯PWAçŠ¶æ€æ¢å¤æ—¶
                    document.documentElement.style.backgroundColor = '#000000';
                    document.body.style.backgroundColor = '#000000';
                    document.body.style.color = '#e0e0e0';
                    document.body.classList.add('theme-dark');

                    // ç¡®ä¿meta theme-coloræ­£ç¡®
                    const metaThemeColor = document.querySelector('meta[name="theme-color"]');
                    if (metaThemeColor) {
                        metaThemeColor.setAttribute('content', '#000000');
                    }

                    // å¼ºåˆ¶è¦†ç›–å¯èƒ½çš„ç™½è‰²æ ·å¼
                    const style = document.createElement('style');
                    style.textContent = `
                        html, body, #app {
                            background-color: #000000 !important;
                            background: #000000 !important;
                        }
                    `;
                    document.head.appendChild(style);
                },

                // è®¾ç½®é¡µé¢å¯è§æ€§ç›‘å¬ï¼Œé˜²æ­¢PWAæ¢å¤æ—¶ç™½å±
                setupVisibilityHandler() {
                    const overlay = document.getElementById('pwa-black-overlay');
                    let overlayArmed = false;

                    const ensureDarkPalette = () => {
                        document.documentElement.style.backgroundColor = '#000000';
                        document.body.style.backgroundColor = '#000000';
                        document.body.style.color = '#e0e0e0';
                        document.body.classList.add('theme-dark');

                        const app = document.getElementById('app');
                        if (app) {
                            app.style.backgroundColor = '#000000';
                        }
                    };

                    const dismissKeyboard = () => {
                        try {
                            const active = document.activeElement;
                            if (active && typeof active.blur === 'function') {
                                active.blur();
                            }

                            const editorElement = this.vditor?.vditor?.ir?.element;
                            if (editorElement && typeof editorElement.blur === 'function') {
                                editorElement.blur();
                            }

                            const editorContainer = document.querySelector('.editor-container');
                            if (editorContainer) {
                                editorContainer.classList.remove('keyboard-open');
                            }
                        } catch (error) {
                            console.warn('dismissKeyboard failed', error);
                        }
                    };

                    const showOverlay = () => {
                        if (overlay) {
                            overlay.classList.add('active');
                        }
                    };

                    const hideOverlay = () => {
                        if (overlay) {
                            overlay.classList.remove('active');
                        }
                    };

                    const hideOverlayWithDelay = () => {
                        setTimeout(() => {
                            hideOverlay();
                            overlayArmed = false;
                        }, 180);
                    };

                    this.visibilityHandler = () => {
                        if (document.hidden) {
                            overlayArmed = true;
                            dismissKeyboard();
                            showOverlay();
                            ensureDarkPalette();
                            return;
                        }

                        if (!overlayArmed) {
                            ensureDarkPalette();
                            this.$nextTick(() => this.initTheme());
                            return;
                        }

                        showOverlay();
                        ensureDarkPalette();

                        this.$nextTick(() => {
                            this.initTheme();
                            hideOverlayWithDelay();
                        });
                    };

                    document.addEventListener('visibilitychange', this.visibilityHandler);

                    this.pageHideHandler = () => {
                        overlayArmed = true;
                        dismissKeyboard();
                        showOverlay();
                        ensureDarkPalette();

                        // ğŸ”¥ å…³é”®ä¿®å¤ï¼šå¼ºåˆ¶éšè—æ‰€æœ‰å¯èƒ½çš„ç™½è‰²å…ƒç´ ï¼Œç¡®ä¿ iOS å¿«ç…§æ˜¯çº¯é»‘è‰²çš„
                        try {
                            // éšè—æ‰€æœ‰å¯¹è¯æ¡†
                            document.querySelectorAll('.el-dialog, .el-message-box, .el-notification').forEach(el => {
                                el.style.display = 'none';
                            });

                            // éšè—æ‰€æœ‰å¯èƒ½çš„ç™½è‰²èƒŒæ™¯å…ƒç´ 
                            document.querySelectorAll('.el-input, .el-button, .el-form-item').forEach(el => {
                                el.style.opacity = '0';
                            });

                            // å¼ºåˆ¶ Vditor ç¼–è¾‘å™¨ä¸ºé»‘è‰²
                            document.querySelectorAll('.vditor, .vditor-content, .vditor-ir, .vditor-toolbar').forEach(el => {
                                el.style.backgroundColor = '#000000';
                                el.style.color = '#000000';
                            });

                            // å¼ºåˆ¶æ•´ä¸ª app å®¹å™¨ä¸ºçº¯é»‘
                            const app = document.getElementById('app');
                            if (app) {
                                app.style.backgroundColor = '#000000';
                                app.style.color = '#000000';
                            }

                            // å¼ºåˆ¶ header ä¸ºé»‘è‰²
                            document.querySelectorAll('.header, .content-type-selector, .editor-container').forEach(el => {
                                el.style.backgroundColor = '#000000';
                                el.style.color = '#000000';
                            });
                        } catch (error) {
                            console.warn('pageHideHandler cleanup failed', error);
                        }
                    };

                    this.pageShowHandler = (event) => {
                        // ğŸ”¥ æ¢å¤é¡µé¢å…ƒç´ çš„å¯è§æ€§
                        try {
                            document.querySelectorAll('.el-input, .el-button, .el-form-item').forEach(el => {
                                el.style.opacity = '';
                            });

                            document.querySelectorAll('.vditor, .vditor-content, .vditor-ir, .vditor-toolbar').forEach(el => {
                                el.style.color = '';
                            });

                            const app = document.getElementById('app');
                            if (app) {
                                app.style.color = '';
                            }

                            document.querySelectorAll('.header, .content-type-selector, .editor-container').forEach(el => {
                                el.style.color = '';
                            });
                        } catch (error) {
                            console.warn('pageShowHandler restore failed', error);
                        }

                        if (!overlayArmed && !event.persisted) {
                            ensureDarkPalette();
                            this.$nextTick(() => this.initTheme());
                            return;
                        }

                        showOverlay();
                        ensureDarkPalette();

                        if (event.persisted) {
                            this.initTheme();
                        } else {
                            this.$nextTick(() => this.initTheme());
                        }

                        hideOverlayWithDelay();
                    };

                    window.addEventListener('pagehide', this.pageHideHandler);
                    window.addEventListener('pageshow', this.pageShowHandler);

                    // ğŸ”¥ iOS å…³é”®ä¿®å¤ï¼šç›‘å¬ blur äº‹ä»¶ï¼Œè¿™æ¯” pagehide æ›´æ—©è§¦å‘
                    // å½“ç”¨æˆ·åˆ‡æ¢åº”ç”¨æ—¶ï¼Œwindow ä¼šå¤±å»ç„¦ç‚¹ï¼Œæ­¤æ—¶ç«‹å³æ˜¾ç¤ºé»‘è‰²é®ç½©
                    window.addEventListener('blur', () => {
                        if (this.isMobileDevice()) {
                            showOverlay();
                            ensureDarkPalette();

                            // ç«‹å³å¼ºåˆ¶æ‰€æœ‰å…ƒç´ å˜é»‘
                            try {
                                document.querySelectorAll('.el-dialog, .el-message-box, .el-notification').forEach(el => {
                                    el.style.display = 'none';
                                });
                                document.querySelectorAll('.el-input, .el-button, .el-form-item, .vditor, .header').forEach(el => {
                                    el.style.opacity = '0';
                                });
                            } catch (e) {}
                        }
                    });

                    // å½“çª—å£é‡æ–°è·å¾—ç„¦ç‚¹æ—¶æ¢å¤ï¼ˆä½†ä½¿ç”¨å»¶è¿Ÿï¼Œé¿å…é—ªçƒï¼‰
                    window.addEventListener('focus', () => {
                        if (this.isMobileDevice()) {
                            setTimeout(() => {
                                try {
                                    document.querySelectorAll('.el-input, .el-button, .el-form-item, .vditor, .header').forEach(el => {
                                        el.style.opacity = '';
                                    });
                                } catch (e) {}
                            }, 100);
                        }
                    });
                },

                initVditor() {
                    const editorMode = 'ir';
                    const vditorTheme = 'dark';

                    // æ ¹æ®è®¾å¤‡ç±»å‹è®¾ç½®ä¸åŒçš„å·¥å…·æ 
                    const isMobile = this.isMobileDevice();
                    // ç§»åŠ¨ç«¯æ”¹ç”±å¤´éƒ¨æ“ä½œåŒºæä¾›ä¸Šä¼ æŒ‰é’®
                    const toolbar = isMobile ? [] : [
                        // æ¡Œé¢ç«¯å®Œæ•´å·¥å…·æ 
                        'emoji', 'headings', 'bold', 'italic', 'strike', 'link', '|',
                        'list', 'ordered-list', 'check', 'outdent', 'indent', '|',
                        'quote', 'line', 'code', 'inline-code', 'insert-before', 'insert-after', '|',
                        'upload', 'table', '|',
                        'undo', 'redo', '|',
                        'edit-mode', '|',
                        'outline', 'preview', 'fullscreen'
                    ];

                    this.vditor = new Vditor('vditor', {
                        height: '100%',
                        mode: editorMode,
                        theme: vditorTheme,
                        preview: {
                            theme: { current: vditorTheme },
                            actions: []
                        },
                        toolbar: toolbar,
                        upload: {
                            accept: 'image/*',
                            multiple: true,
                            fieldName: 'file[]',
                            filename: (name) => name.replace(/[^(a-zA-Z0-9\u4e00-\u9fa5\.)]/g, ''),
                            handler: (files) => {
                                return this.handleImageUpload(files);
                            }
                        },
                        cache: { enable: false },
                        after: function() {

                            // å°†å…ƒæ•°æ®ç¼–è¾‘å™¨ç§»åŠ¨åˆ°å·¥å…·æ ä¸‹æ–¹
                            const vditorElement = document.getElementById('vditor');
                            const toolbar = vditorElement.querySelector('.vditor-toolbar');
                            const metadataEditor = document.getElementById('metadata-editor-wrapper');
                            if (toolbar && metadataEditor) {
                                toolbar.insertAdjacentElement('afterend', metadataEditor);
                                metadataEditor.style.display = 'block';
                            }

                            // ç»‘å®š input äº‹ä»¶ï¼Œå°†ç¼–è¾‘å™¨å†…å®¹åŒæ­¥åˆ° bodyContent
                            this.vditor.vditor.element.addEventListener('input', () => {
                                this.bodyContent = this.vditor.getValue();
                            });

                            // è®¾ç½®æ‹–æ‹½å’Œç²˜è´´æ”¯æŒ
                            this.setupImageDragAndPaste();

                        }.bind(this)
                    });
                },

                checkGitHubConfig() {
                    const config = localStorage.getItem('github-config');
                    this.isGitHubConfigured = !!config;
                    if (config && window.githubService) {
                        const parsedConfig = JSON.parse(config);
                        window.githubService.setConfig(parsedConfig);
                    }
                },

                checkForEditFile() {
                    const urlParams = new URLSearchParams(window.location.search);
                    const editFile = urlParams.get('edit');
                    if (editFile) {
                        this.loadFileForEdit(editFile);
                    }
                },

                async loadFileForEdit(filePath) {
                    if (!this.isGitHubConfigured) {
                        this.$message.warning('è¯·å…ˆé…ç½®GitHub');
                        return;
                    }
                    try {
                        this.$message({ message: 'æ­£åœ¨åŠ è½½æ–‡ä»¶...', type: 'info' });
                        const fileData = await window.githubService.getFile(filePath);
                        if (fileData) {
                            const { metadata, content } = this.parseContentWithFrontmatter(fileData.content);
                            
                            if (filePath.includes('/posts/')) {
                                this.currentType = contentTypes.BLOG;
                            } else if (filePath.includes('/essays/')) {
                                this.currentType = contentTypes.ESSAY;
                            }
                            
                            const normalizedMetadata = { ...metadata };
                            if (Array.isArray(normalizedMetadata.categories)) {
                                normalizedMetadata.categories = normalizedMetadata.categories.join(', ');
                            }
                            this.metadata = normalizedMetadata;
                            this.bodyContent = content;
                            if (this.vditor) {
                                this.vditor.setValue(content);
                            }
                            this.editingFile = {
                                path: filePath,
                                sha: fileData.sha || null
                            };
                            this.$message.success('æ–‡ä»¶åŠ è½½æˆåŠŸ');
                        }
                    } catch (error) {
                        this.$message.error(`åŠ è½½æ–‡ä»¶å¤±è´¥: ${error.message}`);
                    }
                },

                getTypeIcon(type) {
                    const icons = {
                        [contentTypes.BLOG]: 'el-icon-document',
                        [contentTypes.ESSAY]: 'el-icon-edit-outline',
                        [contentTypes.GALLERY]: 'el-icon-picture'
                    };
                    return icons[type] || 'el-icon-document';
                },

                selectType(type) {
                    this.currentType = type;
                    this.resetMetadata(type);
                    this.bodyContent = '';
                    if (this.vditor) {
                        this.vditor.setValue('');
                    }
                    this.editingFile = null;

                    // Galleryæ¨¡å¼é‡ç½®é¢„è§ˆ
                    if (type === contentTypes.GALLERY) {
                        this.resetGalleryPreview();
                    }
                },

                resetMetadata(type) {
                    const now = new Date();
                    let newMeta = {};

                    if (type === contentTypes.BLOG) {
                        const dateStr = now.toISOString().split('T')[0];
                        newMeta = {
                            title: '',
                            categories: 'Daily',
                            pubDate: dateStr
                        };
                    } else if (type === contentTypes.ESSAY) {
                        const dateTimeStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
                        newMeta = {
                            pubDate: dateTimeStr
                        };
                    } else if (type === contentTypes.GALLERY) {
                        const dateStr = now.toISOString().split('T')[0];
                        newMeta = {
                            date: dateStr
                        };
                    }
                    this.metadata = newMeta;
                },

                setCursorToPosition(position) {
                    try {
                        // æ–¹æ³•1: å°è¯•ä½¿ç”¨Vditorçš„API
                        if (this.vditor.setCursorPosition) {
                            this.vditor.setCursorPosition(position);
                            return;
                        }
                    } catch (e) {
                        // Vditor API method failed, trying direct DOM manipulation
                    }

                    // æ–¹æ³•2: ç›´æ¥æ“ä½œDOMå…ƒç´ 
                    const editor = this.vditor.vditor.element.querySelector('.vditor-textarea') ||
                                 this.vditor.vditor.element.querySelector('textarea') ||
                                 this.vditor.vditor.element.querySelector('.vditor-ir');

                    if (editor) {
                        if (editor.setSelectionRange) {
                            editor.setSelectionRange(position, position);
                            editor.focus();
                        } else if (editor.createTextRange) {
                            // IEå…¼å®¹
                            const range = editor.createTextRange();
                            range.move('character', position);
                            range.select();
                        }
                    }
                },

                parseContentWithFrontmatter(content) {
                    // æ£€æŸ¥æ˜¯å¦æœ‰frontmatter
                    if (!content.startsWith('---')) {
                        return { metadata: {}, content: content };
                    }

                    const lines = content.split('\n');
                    let frontmatterEnd = -1;

                    // æ‰¾åˆ°frontmatterç»“æŸä½ç½®
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim() === '---') {
                            frontmatterEnd = i;
                            break;
                        }
                    }

                    if (frontmatterEnd === -1) {
                        return { metadata: {}, content: content };
                    }

                    // æå–frontmatter
                    const frontmatterLines = lines.slice(1, frontmatterEnd);
                    const bodyContent = lines.slice(frontmatterEnd + 1).join('\n');

                    // è§£æfrontmatter
                    const metadata = {};
                    frontmatterLines.forEach(line => {
                        const colonIndex = line.indexOf(':');
                        if (colonIndex > 0) {
                            const key = line.substring(0, colonIndex).trim();
                            let value = line.substring(colonIndex + 1).trim();

                            // å¤„ç†ç©ºå€¼
                            if (!value || value.trim() === '') {
                                value = '';
                            } else {
                                // ç§»é™¤å¼•å·
                                if ((value.startsWith('"') && value.endsWith('"')) ||
                                    (value.startsWith("'") && value.endsWith("'"))) {
                                    value = value.slice(1, -1);
                                }

                                // å¤„ç†æ•°ç»„æ ¼å¼
                                if (value.startsWith('[') && value.endsWith(']')) {
                                    try {
                                        value = JSON.parse(value);
                                    } catch (e) {
                                        // å¦‚æœè§£æå¤±è´¥ï¼Œä¿æŒåŸå€¼
                                    }
                                }
                            }

                            metadata[key] = value;
                        }
                    });

                    return { metadata, content: bodyContent };
                },

                async publish() {
                    if (!this.isGitHubConfigured) {
                        this.$message.warning('è¯·å…ˆé…ç½®GitHub');
                        return;
                    }

                    // Galleryæ¨¡å¼ç‰¹æ®Šå¤„ç†
                    if (this.currentType === contentTypes.GALLERY) {
                        return await this.publishGalleryImage();
                    }

                    // ä»ç¼–è¾‘å™¨è·å–æœ€æ–°çš„æ­£æ–‡
                    this.bodyContent = this.vditor.getValue();

                    // æ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹ï¼ˆæ­£æ–‡ä¸èƒ½ä¸ºç©ºï¼‰
                    if (!this.bodyContent.trim()) {
                        this.$message.warning('è¯·å…ˆç¼–å†™å†…å®¹');
                        return;
                    }

                    if (this.currentType === contentTypes.BLOG && !this.metadata.title) {
                        this.$message.warning('è¯·å…ˆè®¾ç½®æ ‡é¢˜');
                        return;
                    }

                    const finalContent = generateContentWithMetadata(this.currentType, this.metadata, this.bodyContent);

                    // è·å–å‘å¸ƒæŒ‰é’®å…ƒç´ 
                    const publishButton = document.querySelector('.publish-button');

                    try {
                        this.$message({ message: 'æ­£åœ¨å‘å¸ƒ...', type: 'info' });

                        const wasEditing = !!this.editingFile;
                        const publishOptions = this.editingFile ? {
                            path: this.editingFile.path,
                            sha: this.editingFile.sha
                        } : undefined;

                        const result = await window.githubService.publishContent(
                            this.currentType,
                            this.metadata,
                            finalContent,
                            publishOptions
                        );

                        if (result.success) {
                            // æ·»åŠ æˆåŠŸçŠ¶æ€åŠ¨ç”»
                            if (publishButton) {
                                publishButton.classList.add('success');

                                // 1.5ç§’åç§»é™¤æˆåŠŸçŠ¶æ€
                                setTimeout(() => {
                                    publishButton.classList.remove('success');
                                }, 1500);
                            }

                            this.$message({
                                message: `å‘å¸ƒæˆåŠŸï¼æ–‡ä»¶å·²${result.action === 'add' ? 'åˆ›å»º' : 'æ›´æ–°'}`,
                                type: 'success'
                            });

                            if (result.sha) {
                                this.editingFile = {
                                    path: result.filePath,
                                    sha: result.sha
                                };
                            } else {
                                this.editingFile = null;
                            }

                            if (!wasEditing && result.action === 'add') {
                                this.editingFile = null;
                                this.selectType(this.currentType); // é‡ç½®
                            }
                        }
                    } catch (error) {
                        console.error('å‘å¸ƒå¤±è´¥:', error);
                        this.$message.error(`å‘å¸ƒå¤±è´¥: ${error.message}`);
                    }
                },

                configureGitHub() {
                    this.githubConfigVisible = true;
                },

                handleGitHubConfigSave(payload) {
                    const githubConfig = payload?.github || payload;
                    const imageConfig = payload?.image;
                    const linkRule = payload?.linkRule;

                    if (githubConfig && window.githubService) {
                        window.githubService.setConfig(githubConfig);
                    }

                    if (imageConfig && window.imageService) {
                        window.imageService.setConfig(imageConfig);
                        if (linkRule && typeof window.imageService.setLinkRule === 'function') {
                            window.imageService.setLinkRule(linkRule);
                        }
                    }

                    this.checkGitHubConfig();
                    this.checkImageServiceConfig();
                    this.$message.success('é…ç½®å·²ä¿å­˜');
                },

                // æ£€æŸ¥å›¾ç‰‡æœåŠ¡é…ç½®
                checkImageServiceConfig() {
                    this.isImageServiceConfigured = window.imageService && window.imageService.isConfigured();
                },

                // æ£€æµ‹PWAæ¨¡å¼
                detectPWAMode() {
                    this.isPWAMode = window.navigator.standalone === true ||
                                     window.matchMedia('(display-mode: standalone)').matches;
                },

                // æ£€æŸ¥PWAæ¨¡å¼ä¸‹é…ç½®ç¼ºå¤±çš„æƒ…å†µ
                checkPWAConfigMissing() {
                    // æ£€æµ‹æ˜¯å¦ä¸ºPWAæ¨¡å¼ï¼ˆä¿å­˜åˆ°ä¸»å±å¹•ï¼‰
                    const isPWA = window.navigator.standalone === true ||
                                  window.matchMedia('(display-mode: standalone)').matches;

                    if (isPWA) {
                        // å»¶è¿Ÿæ£€æŸ¥ï¼Œç¡®ä¿æ‰€æœ‰ç»„ä»¶éƒ½å·²åˆå§‹åŒ–
                        setTimeout(() => {
                            const hasImageConfig = localStorage.getItem('image-service-config');
                            const hasGitHubConfig = localStorage.getItem('github-config');

                            if (!hasImageConfig || !hasGitHubConfig) {
                                this.showPWAConfigDialog();
                            }
                        }, 1000);
                    }
                },

                showPWAConfigDialog() {
                    this.$confirm(
                        'PWAæ¨¡å¼ä¸‹éœ€è¦é‡æ–°é…ç½®ã€‚è¿™æ˜¯å› ä¸ºPWAå’Œæµè§ˆå™¨ä½¿ç”¨ä¸åŒçš„å­˜å‚¨ç©ºé—´ã€‚æ˜¯å¦ç°åœ¨é…ç½®ï¼Ÿ',
                        'PWAé…ç½®æé†’',
                        {
                            confirmButtonText: 'ç«‹å³é…ç½®',
                            cancelButtonText: 'ç¨åé…ç½®',
                            type: 'info',
                            customClass: 'pwa-config-dialog'
                        }
                    ).then(() => {
                        // æ‰“å¼€é…ç½®å¯¹è¯æ¡†
                        this.githubConfigVisible = true;
                    }).catch(() => {
                        // ç”¨æˆ·é€‰æ‹©ç¨åé…ç½®ï¼Œæ˜¾ç¤ºæç¤º
                        this.$message({
                            message: 'æç¤ºï¼šå›¾ç‰‡ä¸Šä¼ åŠŸèƒ½éœ€è¦å…ˆé…ç½®GitHubä»“åº“ä¿¡æ¯',
                            type: 'warning',
                            duration: 5000
                        });
                    });
                },

                // å¿«é€Ÿé…ç½®åŠŸèƒ½ï¼ˆç”¨äºPWAæ¨¡å¼ï¼‰
                showQuickConfig() {
                    this.$prompt('è¯·è¾“å…¥GitHub Token:', 'å¿«é€Ÿé…ç½®', {
                        confirmButtonText: 'ç¡®å®š',
                        cancelButtonText: 'å–æ¶ˆ',
                        inputType: 'password',
                        inputPlaceholder: 'è¯·è¾“å…¥æ‚¨çš„GitHub Personal Access Token'
                    }).then(({ value }) => {
                        if (value) {
                            this.applyQuickConfig(value);
                        }
                    }).catch(() => {
                        this.$message.info('å·²å–æ¶ˆé…ç½®');
                    });
                },

                applyQuickConfig(token) {
                    // ä½¿ç”¨é¢„è®¾çš„é…ç½®ä¿¡æ¯
                    const imageConfig = {
                        token: token,
                        owner: 'SUNSIR007',
                        repo: 'picx-images-hosting',
                        branch: 'master',
                        imageDir: 'images'
                    };

                    const githubConfig = {
                        token: token,
                        owner: 'SUNSIR007',
                        repo: 'markdown-online-editor'
                    };

                    // ä¿å­˜é…ç½®
                    localStorage.setItem('image-service-config', JSON.stringify(imageConfig));
                    localStorage.setItem('github-config', JSON.stringify(githubConfig));
                    localStorage.setItem('image-service-link-rule', 'jsdelivr');

                    // åº”ç”¨é…ç½®
                    if (window.imageService) {
                        window.imageService.setConfig(imageConfig);
                        window.imageService.setLinkRule('jsdelivr');
                    }
                    if (window.githubService) {
                        window.githubService.setConfig(githubConfig);
                    }

                    // æ›´æ–°çŠ¶æ€
                    this.checkGitHubConfig();
                    this.checkImageServiceConfig();

                    this.$message.success('å¿«é€Ÿé…ç½®å®Œæˆï¼');
                },

                // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
                async handleImageUpload(files) {
                    if (!this.isImageServiceConfigured) {
                        this.$message.warning('è¯·å…ˆé…ç½®å›¾åºŠæœåŠ¡');
                        return Promise.reject('å›¾åºŠæœªé…ç½®');
                    }

                    const fileArray = Array.from(files);
                    this.uploadingImages = true;
                    this.uploadProgress.visible = true;
                    this.uploadProgress.total = fileArray.length;

                    // æ¸…é™¤æ‹–æ‹½è§†è§‰æ•ˆæœ
                    const vditorElement = document.getElementById('vditor');
                    if (vditorElement) {
                        vditorElement.classList.remove('drag-over');
                    }

                    // ç§»åŠ¨ç«¯è°ƒè¯•ä¿¡æ¯
                    if (this.isMobileDevice()) {
                        console.log('ç§»åŠ¨ç«¯ä¸Šä¼ å¼€å§‹:', {
                            fileCount: fileArray.length,
                            files: fileArray.map(f => ({ name: f.name, size: f.size, type: f.type })),
                            userAgent: navigator.userAgent,
                            imageServiceConfig: {
                                owner: window.imageService?.owner,
                                repo: window.imageService?.repo,
                                branch: window.imageService?.branch,
                                isConfigured: window.imageService?.isConfigured()
                            }
                        });
                    }

                    try {
                        const results = await window.imageService.uploadImages(fileArray, {
                            compress: true,
                            quality: 0.8,
                            addHash: true,
                            onProgress: (progress) => {
                                this.uploadProgress.current = progress.current;
                                this.uploadProgress.fileName = progress.fileName;
                                this.uploadProgress.stage = progress.stage;
                                this.uploadProgress.progress = progress.singleProgress || 0;
                                this.uploadProgress.currentSize = progress.currentSize || 0;
                                this.uploadProgress.targetSize = progress.targetSize || 0;
                                this.uploadProgress.quality = progress.quality || 0;
                            },
                            onSingleComplete: (result, index) => {
                                if (result.success) {
                                    // æ’å…¥Markdownå›¾ç‰‡è¯­æ³•åˆ°ç¼–è¾‘å™¨
                                    const imageMarkdown = `![${result.fileName}](${result.url})\n`;
                                    this.insertTextToEditor(imageMarkdown);
                                    this.$message.success(`å›¾ç‰‡ ${result.fileName} ä¸Šä¼ æˆåŠŸ`);
                                } else {
                                    this.$message.error(`å›¾ç‰‡ ${result.fileName} ä¸Šä¼ å¤±è´¥: ${result.error}`);
                                    // ç§»åŠ¨ç«¯é¢å¤–é”™è¯¯ä¿¡æ¯
                                    if (this.isMobileDevice()) {
                                        console.error('ç§»åŠ¨ç«¯ä¸Šä¼ å¤±è´¥è¯¦æƒ…:', result);
                                    }
                                }
                            }
                        });

                        const successCount = results.filter(r => r.success).length;
                        const failCount = results.length - successCount;

                        if (successCount > 0) {
                            this.$message.success(`æˆåŠŸä¸Šä¼  ${successCount} å¼ å›¾ç‰‡${failCount > 0 ? `ï¼Œ${failCount} å¼ å¤±è´¥` : ''}`);
                        }

                        return Promise.resolve(results);

                    } catch (error) {
                        console.error('å›¾ç‰‡ä¸Šä¼ é”™è¯¯:', error);
                        // ç§»åŠ¨ç«¯æ˜¾ç¤ºè¯¦ç»†é”™è¯¯å¯¹è¯æ¡†
                        if (this.isMobileDevice()) {
                            this.showMobileError(error, 'å›¾ç‰‡ä¸Šä¼ ');
                        } else {
                            this.$message.error(`å›¾ç‰‡ä¸Šä¼ å¤±è´¥: ${error.message}`);
                        }
                        return Promise.reject(error);
                    } finally {
                        this.uploadingImages = false;
                        this.uploadProgress.visible = false;
                    }
                },

                // æ’å…¥æ–‡æœ¬åˆ°ç¼–è¾‘å™¨
                insertTextToEditor(text) {
                    if (this.vditor) {
                        this.vditor.insertValue(text);
                    }
                },

                // æ˜¾ç¤ºç§»åŠ¨ç«¯é”™è¯¯è¯¦æƒ…
                showMobileError(error, context = '') {
                    if (this.isMobileDevice()) {
                        const errorInfo = {
                            æ—¶é—´: new Date().toLocaleString(),
                            é”™è¯¯: error.message || error,
                            ä¸Šä¸‹æ–‡: context,
                            ç”¨æˆ·ä»£ç†: navigator.userAgent,
                            URL: window.location.href,
                            å›¾åºŠé…ç½®: window.imageService ? {
                                owner: window.imageService.owner,
                                repo: window.imageService.repo,
                                branch: window.imageService.branch,
                                å·²é…ç½®: window.imageService.isConfigured()
                            } : 'æœªåˆå§‹åŒ–'
                        };

                        this.mobileErrorDialog.content = JSON.stringify(errorInfo, null, 2);
                        this.mobileErrorDialog.visible = true;
                    }
                },

                // å¤åˆ¶é”™è¯¯ä¿¡æ¯åˆ°å‰ªè´´æ¿
                async copyErrorToClipboard() {
                    try {
                        await navigator.clipboard.writeText(this.mobileErrorDialog.content);
                        this.$message.success('é”™è¯¯ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    } catch (err) {
                        // é™çº§æ–¹æ¡ˆ
                        const textArea = document.createElement('textarea');
                        textArea.value = this.mobileErrorDialog.content;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        this.$message.success('é”™è¯¯ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    }
                },

                // è®¾ç½®å›¾ç‰‡æ‹–æ‹½å’Œç²˜è´´æ”¯æŒ
                setupImageDragAndPaste() {
                    const vditorElement = document.getElementById('vditor');
                    if (!vditorElement) return;

                    // æ‹–æ‹½æ”¯æŒ
                    vditorElement.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        vditorElement.classList.add('drag-over');
                    });

                    vditorElement.addEventListener('dragleave', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        vditorElement.classList.remove('drag-over');
                    });

                    vditorElement.addEventListener('drop', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        vditorElement.classList.remove('drag-over');

                        const files = Array.from(e.dataTransfer.files).filter(file =>
                            file.type.startsWith('image/')
                        );

                        if (files.length > 0) {
                            this.handleImageUpload(files);
                        }
                    });

                    // ç²˜è´´æ”¯æŒ
                    vditorElement.addEventListener('paste', (e) => {
                        const items = Array.from(e.clipboardData.items);
                        const imageItems = items.filter(item => item.type.startsWith('image/'));

                        if (imageItems.length > 0) {
                            e.preventDefault();
                            const files = imageItems.map(item => item.getAsFile()).filter(file => file);
                            if (files.length > 0) {
                                this.handleImageUpload(files);
                            }
                        }
                    });
                },

                // Galleryç›¸å…³æ–¹æ³•
                resetGalleryPreview() {
                    this.galleryPreview = {
                        url: null,
                        fileName: '',
                        size: 0,
                        file: null
                    };
                },

                // è·å–é˜¶æ®µæ–‡æœ¬
                getStageText(stage) {
                    const stageTexts = {
                        'preparing': 'å‡†å¤‡ä¸­...',
                        'analyzing': 'åˆ†æå›¾ç‰‡...',
                        'compressing': 'æ™ºèƒ½å‹ç¼©ä¸­...',
                        'converting': 'è½¬æ¢ä¸­...',
                        'uploading': 'ä¸Šä¼ ä¸­...',
                        'generating': 'ç”Ÿæˆé“¾æ¥...',
                        'finalizing': 'å®Œæˆå¤„ç†...',
                        'completed': 'å®Œæˆ'
                    };
                    return stageTexts[stage] || 'å¤„ç†ä¸­...';
                },

                // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
                formatFileSize(bytes) {
                    if (bytes === 0) return '0 Bytes';
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                },

                async publishGalleryImage() {
                    // ä»ç¼–è¾‘å™¨å†…å®¹ä¸­æå–å›¾ç‰‡URL
                    const content = this.vditor.getValue();
                    const imageUrlMatch = content.match(/!\[.*?\]\((https?:\/\/[^\)]+)\)/);

                    if (!imageUrlMatch) {
                        this.$message.warning('è¯·å…ˆåœ¨ç¼–è¾‘å™¨ä¸­ä¸Šä¼ å›¾ç‰‡');
                        return;
                    }

                    const imageUrl = imageUrlMatch[1];

                    const publishButton = document.querySelector('.publish-button');

                    try {
                        this.$message({ message: 'æ­£åœ¨ä¿å­˜å›¾ç‰‡ä¿¡æ¯...', type: 'info' });

                        // åˆ›å»ºå›¾ç‰‡æ•°æ®
                        const imageData = {
                            url: imageUrl,
                            thumbnail: imageUrl, // ä½¿ç”¨åŒä¸€ä¸ªURLä½œä¸ºç¼©ç•¥å›¾
                            date: this.metadata.date
                        };

                        // ç”Ÿæˆæ–‡ä»¶åï¼ˆä½¿ç”¨æ—¶é—´æˆ³ï¼‰
                        const fileName = this.generateGalleryFileName();
                        const filePath = `src/content/photos/${fileName}.json`;

                        // ä¿å­˜JSONæ–‡ä»¶åˆ°GitHub
                        const jsonContent = JSON.stringify(imageData, null, 2);
                        const result = await window.githubService.createOrUpdateFile(
                            filePath,
                            jsonContent,
                            `Add gallery image: ${fileName}`
                        );

                        if (publishButton) {
                            publishButton.classList.add('success');
                            setTimeout(() => {
                                publishButton.classList.remove('success');
                            }, 1500);
                        }

                        this.$message({
                            message: 'å›¾ç‰‡å‘å¸ƒæˆåŠŸï¼',
                            type: 'success'
                        });

                        this.selectType(this.currentType); // é‡ç½®

                    } catch (error) {
                        console.error('å‘å¸ƒå¤±è´¥:', error);
                        this.$message.error(`å‘å¸ƒå¤±è´¥: ${error.message}`);
                    }
                },

                generateGalleryFileName() {
                    // ä½¿ç”¨æ—¶é—´æˆ³ç”Ÿæˆæ–‡ä»¶å
                    const now = new Date();
                    const timestamp = now.getTime();
                    const dateStr = now.toISOString().split('T')[0]; // YYYY-MM-DD
                    return `photo-${dateStr}-${timestamp}`;
                }
            }
        });

        }); // ç»“æŸDOMContentLoadedäº‹ä»¶ç›‘å¬å™¨
    </script>
</body>
</html>
